---
title: "Dynamic Programming"
---

# Introduction <!-- from day16.pptx -->

::: {.titlereading}
Readings in CLRS 4th edition: chapter 14
:::

## Warm Up

&nbsp;

<p style="text-align:center;font-size:1.5em">$2 \times n$ board with dominoes?</p>

&nbsp;

<table><tr><td>

How many ways to tile this:

<table class="dominogrid">
	<tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>
	<tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>
</table>

With these?

<table class="allcenter"><tr>
<td><table class="dominov"><tr><td></td></tr></table></td>
<td><table class="dominoh"><tr><td></td></tr></table></td>
</tr></table>

</td><td>

For example:

<table class="dominoholder"><tr>
<td><table class="dominov"><tr><td></td></tr></table><td>
<td><table class="dominov"><tr><td></td></tr></table><td>
<td style="vertical-align:top">
	<table>
		<tr><td><table class="dominoh"><tr><td></td></tr></table></td></tr>
		<tr><td><table class="dominoh"><tr><td></td></tr></table></td></tr>
	</table>
</td>
<td style="vertical-align:top">
	<table>
		<tr><td><table class="dominoh"><tr><td></td></tr></table></td></tr>
		<tr><td><table class="dominoh"><tr><td></td></tr></table></td></tr>
	</table>
</td>
<td><table class="dominov"><tr><td></td></tr></table><td>
</tr></table>

&nbsp;

<table class="dominoholder"><tr>
<td style="vertical-align:top">
	<table>
		<tr><td><table class="dominoh"><tr><td></td></tr></table></td></tr>
		<tr><td><table class="dominoh"><tr><td></td></tr></table></td></tr>
	</table>
</td>
<td style="vertical-align:top">
	<table>
		<tr><td><table class="dominoh"><tr><td></td></tr></table></td></tr>
		<tr><td><table class="dominoh"><tr><td></td></tr></table></td></tr>
	</table>
</td>
<td><table class="dominov"><tr><td></td></tr></table><td>
<td><table class="dominov"><tr><td></td></tr></table><td>
<td><table class="dominov"><tr><td></td></tr></table><td>
</tr></table>

</td></tr></table>

----

## Warm Up

How many ways are there to tile a $2 \times n$ board with dominoes?

:::: {.columns}

::: {.column width="50%"}
<p class="xx-large">Two ways to fill the final column:</p>

::: {.fragment fragment-index=1}
<table class="cells" style="margin-left:0">
<tr><td></td><td></td><td></td><td></td><td></td><td class='clear'></td><td class='green'></td></tr>
<tr class="trbottom"><td></td><td></td><td></td><td></td><td></td><td class='clear'></td><td class='green'></td></tr>
</table>
:::

::: {.fragment fragment-index=3}
<p style="margin:0"><img src="images/underbrace-red.svg" style="width:380px;margin:0"></p>

<p style="color:red;text-align:center;font-size:80%;margin-top:0">$n-1$&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</p>
:::

::: {.fragment fragment-index=2}
<table class="cells" style="margin-left:0">
<tr><td></td><td></td><td></td><td></td><td></td><td class='green'></td><td class='green'></td></tr>
<tr class="trbottom"><td></td><td></td><td></td><td></td><td></td><td class='yellow'></td><td class='yellow'></td></tr>
</table>
:::

::: {.fragment fragment-index=4}
<p style="margin:0"><img src="images/underbrace-red.svg" style="width:320px;margin:0"></p>

<p style="color:red;text-align:center;font-size:80%;margin-top:0">$n-2$&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</p>
:::

:::

::: {.column width="30%"}
::: {.fragment fragment-index=5}
<div class="red xx-large">
$$Tile(0) = 1$$
$$Tile(1) = 1$$
$$Tile(n) = Tile(n-1) + Tile(n-2)$$
</div>
:::
:::

::::


## How to compute $Tile(n)$?
&nbsp;
<div class='large-pseudocode'>
```
Tile(n):
	if n < 2:
		return 1
	return Tile(n-1) + Tile(n-2)
```
</div>
&nbsp;

::: {.fragment}
<div class='red' style="font-size:2em">Problem?</div>
:::


## Recursion Tree

```{dot}
digraph BST {
		layout=dot;
		node [fontname="Arial",shape=box,fillcolor=yellow,style="rounded,filled"];
		five [label="Tile(5)"];
		four [label="Tile(4)"];
		threea [label="Tile(3)"];
		threeb [label="Tile(3)"];
		twoa [label="Tile(2)"];
		twob [label="Tile(2)"];
		twoc [label="Tile(2)"];
		onea [label="Tile(1)"];
		oneb [label="Tile(1)"];
		onec [label="Tile(1)"];
		oned [label="Tile(1)"];
		onee [label="Tile(1)"];
		zeroa [label="Tile(0)"];
		zerob [label="Tile(0)"];
		zeroc [label="Tile(0)"];

		five -> four;
		five -> threea;
		four -> threeb;
		four -> twoa;
		threea -> twob;
		threea -> onea;
		threeb -> twoc;
		threeb -> oneb;
		twoa -> onec;
		twoa -> zeroa;
		twob -> oned;
		twob -> zerob;
		twoc -> onee;
		twoc -> zeroc;
}
```


## Recursion Tree

```{dot}
digraph BST2 {
		layout=dot;
		node [fontname="Arial",shape=box,fillcolor=red,style="rounded,filled"];
		five [label="Tile(5)",fillcolor=yellow];
		four [label="Tile(4)",fillcolor=yellow];
		threea [label="Tile(3)"];
		threeb [label="Tile(3)",fillcolor=yellow];
		twoa [label="Tile(2)"];
		twob [label="Tile(2)"];
		twoc [label="Tile(2)",fillcolor=yellow];
		onea [label="Tile(1)"];
		oneb [label="Tile(1)"];
		onec [label="Tile(1)"];
		oned [label="Tile(1)"];
		onee [label="Tile(1)",fillcolor=yellow];
		zeroa [label="Tile(0)"];
		zerob [label="Tile(0)"];
		zeroc [label="Tile(0)",fillcolor=yellow];

		five -> four;
		five -> threea;
		four -> threeb;
		four -> twoa;
		threea -> twob;
		threea -> onea;
		threeb -> twoc;
		threeb -> oneb;
		twoa -> onec;
		twoa -> zeroa;
		twob -> oned;
		twob -> zerob;
		twoc -> onee;
		twoc -> zeroc;
}
```

<table><tr><td>
::: {.fragment}
<p class='red center' style="margin:0">Many redundant calls!</p>
:::
</td><td>
::: {.fragment}
<p class='red center' style="margin:0">Run time: $\Theta(1.6^n)$</p>
:::
</td></tr>
<tr><td colspan='2'>
::: {.fragment}
<p class='magenta' style="margin:0">Better way: Use Memory!</p>
:::
</td></tr></table>


## Computing $Tile(n)$ with memory

:::: {.columns}

::: {.column width="80%"}
&nbsp;
<div class='large-pseudocode'>
```
Initialize memory M
Tile(n):
	if n < 2:
		return 1
	if M[n] is filled:
		return M[n]
	M[n] = Tile(n-1)+Tile(n-2)
	return M[n]
```
</div>
&nbsp;

::: {.fragment}
<table class="purplenote"><tr><td>Technique: memoization (note no 'r')</td></tr></table>
:::
:::

::: {.column width="10%"}
<table class='cells'>
<tr><td class="noborder" style="min-width:50px">M</td><td class="noborder"></td></tr>
<tr><td>&nbsp;</td><td class="noborder magentatext">0</td></tr>
<tr><td>&nbsp;</td><td class="noborder magentatext">1</td></tr>
<tr><td>&nbsp;</td><td class="noborder magentatext">2</td></tr>
<tr><td>&nbsp;</td><td class="noborder magentatext">3</td></tr>
<tr><td>&nbsp;</td><td class="noborder magentatext">4</td></tr>
<tr><td>&nbsp;</td><td class="noborder magentatext">5</td></tr>
<tr><td class="tdbottom">&nbsp;</td><td class="noborder magentatext">6</td></tr>
</table>
:::

::::




## Computing $Tile(n)$ with memory

:::: {.columns}

::: {.column width="80%"}
&nbsp;
<div class='large-pseudocode'>
```
Initialize memory M
Tile(n):
	if n < 2:
		return 1
	if M[n] is filled:
		return M[n]
	M[n] = Tile(n-1)+Tile(n-2)
	return M[n]
```
</div>
:::

::: {.column width="10%"}
<table class='cells'>
<tr><td class="noborder" style="min-width:50px">M</td><td class="noborder"></td></tr>
<tr><td>1</td><td class="noborder magentatext">0</td></tr>
<tr><td>1</td><td class="noborder magentatext">1</td></tr>
<tr><td>2</td><td class="noborder magentatext">2</td></tr>
<tr><td>3</td><td class="noborder magentatext">3</td></tr>
<tr><td>5</td><td class="noborder magentatext">4</td></tr>
<tr><td>8</td><td class="noborder magentatext">5</td></tr>
<tr><td class="tdbottom">13</td><td class="noborder magentatext">6</td></tr>
</table>
:::

::::



## Dynamic Programming

- Requires <span class="magenta">Optimal Substructure</span>
	- Solution to larger problem contains the (optimal) solutions to smaller ones
- Idea:
	1. Identify recursive structure of the problem
		- What is the "last thing" done?

::: {.fragment}

<table><tr><td>

<table class="cells">
<tr><td></td><td></td><td></td><td></td><td></td><td class='clear'></td><td class='green'></td></tr>
<tr class="trbottom"><td></td><td></td><td></td><td></td><td></td><td class='clear'></td><td class='green'></td></tr>
</table>

<p style="margin:0"><img src="images/underbrace-red.svg" style="width:380px;margin:0"></p>

<p style="font-size:80%;text-align:center;color:red">$n-1$</p>

</td><td>

<table class="cells">
<tr><td></td><td></td><td></td><td></td><td></td><td class='green'></td><td class='green'></td></tr>
<tr class="trbottom"><td></td><td></td><td></td><td></td><td></td><td class='yellow'></td><td class='yellow'></td></tr>
</table>

<p style="margin:0"><img src="images/underbrace-red.svg" style="width:320px;margin:0"></p>

<p style="font-size:80%;text-align:center;color:red">$n-2$</p>

</td></tr></table>
:::


## Dynamic Programming

- Requires <span class="magenta">Optimal Substructure</span>
	- Solution to larger problem contains the (optimal) solutions to smaller ones
- Idea:
	1. Identify recursive structure of the problem
		- What is the "last thing" done?
	2. Save the solution to each subproblem in memory



## Generic Divide and Conquer Solution

::: {.no-bullets style="font-size:90%"}
- &nbsp;
- def <b>myDCalgo</b>(<span class='red'>problem</span>):
  - &nbsp;
    - &nbsp;
  - if baseCase(<span class='red'>problem</span>):
    - <span class='purple'>solution</span> = solve(<span class='red'>problem</span>)
&nbsp;
    - &nbsp;
    - return <span class='purple'>solution</span>
  - for <span class='green'>subproblem</span> of <span class='red'>problem</span>:
    - <span class='blue'>subsolutions</span>.append(<b>myDCalgo</b>(<span class='green'>subproblem</span>))
  - <span class='purple'>solution</span> = Combine(<span class='blue'>subsolutions</span>)
  - &nbsp;
  - return <span class='purple'>solution</span>
:::


## Generic Top-Down DP Solution

::: {.no-bullets style="font-size:90%"}
- &nbsp;
- def <b>myDPalgo</b>(<span class='red'>problem</span>):
  - &nbsp;
    - &nbsp;
  - if baseCase(<span class='red'>problem</span>):
    - <span class='purple'>solution</span> = solve(<span class='red'>problem</span>)
&nbsp;
    - &nbsp;
    - return <span class='purple'>solution</span>
  - for <span class='green'>subproblem</span> of <span class='red'>problem</span>:
    - <span class='blue'>subsolutions</span>.append(<b>myDPalgo</b>(<span class='green'>subproblem</span>))
  - <span class='purple'>solution</span> = OptimalSubstructure(<span class='blue'>subsolutions</span>)
  - &nbsp;
  - return <span class='purple'>solution</span>
:::


## Generic Top-Down DP Solution
::: {.no-bullets style="font-size:90%"}
- mem = {}
- def <b>myDPalgo</b>(<span class='red'>problem</span>):
  - if mem[<span class='red'>problem</span>] not blank:
    - return mem[<span class='red'>problem</span>]
  - if baseCase(<span class='red'>problem</span>):
    - <span class='purple'>solution</span> = solve(<span class='red'>problem</span>)
&nbsp;
    - mem[<span class='red'>problem</span>] = <span class='purple'>solution</span>
    - return <span class='purple'>solution</span>
  - for <span class='green'>subproblem</span> of <span class='red'>problem</span>:
    - <span class='blue'>subsolutions</span>.append(<b>myDPalgo</b>(<span class='green'>subproblem</span>))
  - <span class='purple'>solution</span> = OptimalSubstructure(<span class='blue'>subsolutions</span>)
  - mem[<span class='red'>problem</span>] = <span class='purple'>solution</span>
  - return <span class='purple'>solution</span>
:::



## [Computing $Tile(n)$ with memory "Top Down"]{.r-fit-text}

:::: {.columns}

::: {.column width="80%"}
&nbsp;
<div class='large-pseudocode'>
```
Initialize memory M
Tile(n):
	if n < 2:
		return 1
	if M[n] is filled:
		return M[n]
	M[n] = Tile(n-1)+Tile(n-2)
	return M[n]
```
</div>

&nbsp;

::: {.fragment}
<p class='red'>Recursive calls happen in a predictable order</p>
:::

:::

::: {.column width="10%"}
<table class='cells'>
<tr><td class="noborder" style="min-width:50px">M</td><td class="noborder"></td></tr>
<tr><td>1</td><td class="noborder magentatext">0</td></tr>
<tr><td>1</td><td class="noborder magentatext">1</td></tr>
<tr><td>2</td><td class="noborder magentatext">2</td></tr>
<tr><td>3</td><td class="noborder magentatext">3</td></tr>
<tr><td>5</td><td class="noborder magentatext">4</td></tr>
<tr><td>8</td><td class="noborder magentatext">5</td></tr>
<tr><td class="tdbottom">13</td><td class="noborder magentatext">6</td></tr>
</table>
:::

::::



## [Computing $Tile(n)$ with memory "Bottom Up"]{.r-fit-text}

:::: {.columns}

::: {.column width="75%"}
&nbsp;
<div class='large-pseudocode'>
```
Tile(n):
    Initialize memory M
	M[0] = 1
	M[1] = 1
	for i = 2 to n:
	  M[i] = M[i-1] + M[i-2]
	return M[n]
```
</div>

:::

::: {.column width="10%"}
::: {.fragment .fade-down}
<p style="text-align:center;margin-right:0"><img src="images/down-arrow-blue.svg" style="padding-top:50px;height:480px;object-fit:fill;max-width:unset;max-height:unset"></p>
:::
:::

::: {.column width="10%"}
<table class='cells'>
<tr><td class="noborder" style="min-width:50px">M</td><td class="noborder"></td></tr>
<tr><td>&nbsp;</td><td class="noborder magentatext">0</td></tr>
<tr><td>&nbsp;</td><td class="noborder magentatext">1</td></tr>
<tr><td>&nbsp;</td><td class="noborder magentatext">2</td></tr>
<tr><td>&nbsp;</td><td class="noborder magentatext">3</td></tr>
<tr><td>&nbsp;</td><td class="noborder magentatext">4</td></tr>
<tr><td>&nbsp;</td><td class="noborder magentatext">5</td></tr>
<tr><td class="tdbottom">&nbsp;</td><td class="noborder magentatext">6</td></tr>
</table>
:::

::::



## Dynamic Programming

- Requires <span class="magenta">Optimal Substructure</span>
	- Solution to larger problem contains the (optimal) solutions to smaller ones
- Idea:
	1. Identify recursive structure of the problem
		- What is the "last thing" done?
	2. Save the solution to each subproblem in memory
	3. Select a good order for solving subproblems
		- "Top Down": Solve each recursively
		- "Bottom Up": Iteratively solve smallest to largest


## [More on Optimal Substructure Property]{.r-fit-text}
- Detailed discussion on CLRS p. 379
	- If A is an optimal solution to a problem, then the components of A are optimal solutions to subproblems
- Examples (we'll see these come up later):
	- True for coin-changing
	- True for single-source shortest path
	- True for knapsack problem



# Log Cutting <!-- from day16.pptx -->

::: {.titlereading}
Readings in CLRS 4th edition: chapter 14, specifically 14.1
:::


## Log Cutting

<p style="font-size:90%;margin-bottom:50px">Find the best way to cut the log, given a log of length $n$ and<br>
a list (of length $n$) of prices <span class='blue'>$P$</span> where <span class='blue'>$P[i]$</span> is the price of a cut of size $i$</p>


<table class="cells">
<tr><td class='noborder bluetext'>Price:</td><td class='tdbottom'>1</td><td class='tdbottom'>5</td><td class='tdbottom'>8</td><td class='tdbottom'>9</td><td class='tdbottom'>10</td><td class='tdbottom'>17</td><td class='tdbottom'>17</td><td class='tdbottom'>20</td><td class='tdbottom'>24</td><td class='tdbottom'>30</td></tr>
<tr class='magenta noborder'><td>Length:</td><td>1</td><td>2</td><td>3</td><td>4</td><td>5</td><td>6</td><td>7</td><td>8</td><td>9</td><td>10</td></tr>
</table>

::: {.center}
![](images/dp/log.webp){style="width:70%;height:125px;padding-left:175px"}
:::

::: {.no-bullets}
- Select a list of lengths $\ell_1, \ldots, \ell_k$ such that:
  - $\sum\ell_i=n$ to maximize $\sum\color{blue}{P[\ell_i]}$
:::

::: {.fragment}
<p class='red' style="text-align:center">Brute force: $O(2^n)$</p>
:::

## Greedy Algorithm

<span class='red'>Greedy algorithms</span> build a solution by picking the best option "right now"

<table style="width:100%"><tr><td style="text-align:left;height:150px">
::: {.fragment}
- Select the most profitable cut first
:::
</td></tr></table>

<table><tr><td>
<table>
<tr class='border2px'><td class='noborder bluetext' style='border-bottom:0 !important'>Price:</td><td class='tdbottom'>1</td><td class='tdbottom'>18</td><td class='tdbottom'>19</td><td class='tdbottom'>30</td><td class='tdbottom'>50</td><td class='tdbottom'>50</td></tr>
<tr class='magenta noborder'><td>Length:</td><td>1</td><td>2</td><td>3</td><td>4</td><td>5</td><td>6</td></tr>
</table>

::: {.center}
![](images/dp/log.webp){style="width:75%;padding-left:170px"}
:::

</td><td>
::: {.fragment}
<p><span class="red" style="font-size:xx-large">Greedy: Lengths: 5,1</span></p>
<p><span class="red" style="font-size:xx-large">Profit: 51</span></p>
:::
::: {.fragment}
<p><span class="blue" style="font-size:xx-large">Better: Lengths: 2,2,2</span></p>
<p><span class="blue" style="font-size:xx-large">Profit: 54</span></p>
:::
</td></tr></table>



## Greedy Algorithm

<span class='red'>Greedy algorithms</span> build a solution by picking the best option "right now"

<table style="width:100%"><tr><td style="text-align:left;height:150px">

- Select the "most bang for your buck"
	- (best price / length ratio)

</td></tr></table>

<table><tr><td>
<table>
<tr class='border2px'><td class='noborder bluetext' style='border-bottom:0 !important'>Price:</td><td class='tdbottom'>1</td><td class='tdbottom'>18</td><td class='tdbottom'>24</td><td class='tdbottom'>36</td><td class='tdbottom'>50</td><td class='tdbottom'>50</td></tr>
<tr class='magenta noborder'><td>Length:</td><td>1</td><td>2</td><td>3</td><td>4</td><td>5</td><td>6</td></tr>
</table>

::: {.center}
![](images/dp/log.webp){style="width:75%;padding-left:170px"}
:::

</td><td>
<p><span class="red" style="font-size:xx-large">Greedy: Lengths: 5, 1</span></p>
<p><span class="red" style="font-size:xx-large">Profit: 51</span></p>
<p><span class="blue" style="font-size:xx-large">Better: Lengths: 2, 4</span></p>
<p><span class="blue" style="font-size:xx-large">Profit: 54</span></p>
</td></tr></table>


## Dynamic Programming

- Requires <span class="magenta">Optimal Substructure</span>
	- Solution to larger problem contains the (optimal) solutions to smaller ones
- Idea:
<ol>
	<li class="purple">Identify recursive structure of the problem
    	<ul><li>What is the "last thing" done?</li></ul></li>
	<li>Save the solution to each subproblem in memory</li>
	<li>Select a good order for solving subproblems
		<ul>
			<li>"Top Down": Solve each recursively</li>
			<li>"Bottom Up": Iteratively solve smallest to largest</li>
		</ul></li>
</ol>


## 1. Identify Recursive Substructure

<span class='blue'>$P[i] =$</span> value of a cut of length $i$

<span class='magenta'>$Cut(n)=$</span> value of best way to cut a log of length $n$

::: {.fragment fragment-index=4}
$${\color{magenta}Cut(n)} = \max
\begin{cases}
{\color{magenta}Cut(n-1)} + \color{blue}{P[1]} \\
{\color{magenta}Cut(n-2)} + \color{blue}{P[2]} \\
\color{black}{\ldots} \\
{\color{magenta}Cut(0)} + \color{blue}{P[n]}
\end{cases}$$
:::


<table class='compact' style="z-index:1">
<tr><td style="font-size:75%;text-align:center;color:magenta"> 
::: {.fragment fragment-index=3}
$Cut(n-\ell_k)$ <br>
<img src="images/overbrace-red.svg" style="width:500px;height:50px;margin:0">
:::
</td><td style="color:blue;text-align:center;vertical-align:middle;width:100px">
::: {.fragment fragment-index=2}
$\ell_k$
:::
</td></tr>
</table>

<table style="margin-top:-30px">

<tr><td>

::: {.r-stack}
<table class="compact" style="z-index:0">
<tr>
<td style="text-align:left;width:850px">
![](images/dp/log.webp){style="opacity:0.4;filter:alpha(opacity=40);min-width:90%;height:150px"}
</td></tr></table>

::: {.fragment fragment-index=1}
<table style="z-index:2">
<tr><td style="font-size:xx-large;vertical-align:middle;color:magenta">
::: {.fragment fragment-index=3}
best way to cut a log of length $n-\ell_k$
:::
</td><td style="border-left:5px solid blue;font-size:xx-large;height:100px;vertical-align:middle;color:blue">
::: {.fragment fragment-index=2}
last cut
:::
</td>
</tr>
</table>
:::
:::

</td></tr>

</table>


## Dynamic Programming

- Requires <span class="magenta">Optimal Substructure</span>
	- Solution to larger problem contains the (optimal) solutions to smaller ones
- Idea:
<ol>
	<li>Identify recursive structure of the problem
    	<ul><li>What is the "last thing" done?</li></ul></li>
	<li>Save the solution to each subproblem in memory</li>
	<li class="purple">Select a good order for solving subproblems
		<ul>
			<li>"Top Down": Solve each recursively</li>
			<li>"Bottom Up": Iteratively solve smallest to largest</li>
		</ul></li>
</ol>




## [3. Select a Good Order for Solving Subproblems]{.r-fit-text}

Solve Smallest subproblem first

<table><tr><td style="padding:0;vertical-align:middle">
$${\color{magenta}Cut(0)}=0$$
<td style="padding:0;vertical-align:bottom"><img src="images/spacer.png" style="min-height:265px;width:10px"></td>
</tr></table>

<table class="cells">
<tr><td class='noborder bluetext'>Cut(i):</td><td class='tdbottom yellow'>0</td><td class='tdbottom'></td><td class='tdbottom'></td><td class='tdbottom'></td><td class='tdbottom'></td><td class='tdbottom'></td><td class='tdbottom'></td><td class='tdbottom'></td><td class='tdbottom'></td><td class='tdbottom'></td><td class='tdbottom'></td></tr>
<tr class='magenta noborder'><td>Length:</td><td>0</td><td>1</td><td>2</td><td>3</td><td>4</td><td>5</td><td>6</td><td>7</td><td>8</td><td>9</td><td>10</td></tr>
</table>

<table>
<tr><td style="text-align:left;width:800px">
![](images/dp/log.webp){style="padding-left:125px;transform:scaleX(1.5);height:100px;width:0px;object-fit:cover;object-position:0% 0;border-right:5px solid blue"}
</td></tr>
</table>


## [3. Select a Good Order for Solving Subproblems]{.r-fit-text}

Solve Smallest subproblem first

::: {.fragment}
<table><tr><td style="padding:0;vertical-align:middle">
$${\color{magenta}Cut(1)}={\color{magenta}Cut(0)}+\color{blue}{P[1]}$$
</td>
<td style="padding:0;vertical-align:bottom"><img src="images/spacer.png" style="min-height:265px;width:10px"></td>
</tr></table>
:::

<table class="cells">
<tr><td class='noborder bluetext'>Cut(i):</td><td class='tdbottom'>0</td><td class='tdbottom yellow'></td><td class='tdbottom'></td><td class='tdbottom'></td><td class='tdbottom'></td><td class='tdbottom'></td><td class='tdbottom'></td><td class='tdbottom'></td><td class='tdbottom'></td><td class='tdbottom'></td><td class='tdbottom'></td></tr>
<tr class='magenta noborder'><td>Length:</td><td>0</td><td>1</td><td>2</td><td>3</td><td>4</td><td>5</td><td>6</td><td>7</td><td>8</td><td>9</td><td>10</td></tr>
</table>

<table>
<tr><td style="text-align:left;width:800px">
![](images/dp/log.webp){style="padding-left:125px;transform:scaleX(1.5);height:100px;width:50px;object-fit:cover;object-position:0% 0;border-right:5px solid blue"}
</td></tr>
</table>



## [3. Select a Good Order for Solving Subproblems]{.r-fit-text}

Solve Smallest subproblem first

::: {.fragment}
<table><tr><td style="padding:0;vertical-align:middle">
$${\color{magenta}Cut(2)} = \max
\begin{cases}
{\color{magenta}Cut(1)} + \color{blue}{P[1]} \\
{\color{magenta}Cut(0)} + \color{blue}{P[2]} \\
\end{cases}$$
</td>
<td style="padding:0;vertical-align:bottom"><img src="images/spacer.png" style="min-height:265px;width:10px"></td>
</tr></table>
:::

<table class="cells">
<tr><td class='noborder bluetext'>Cut(i):</td><td class='tdbottom'>0</td><td class='tdbottom'></td><td class='tdbottom yellow'></td><td class='tdbottom'></td><td class='tdbottom'></td><td class='tdbottom'></td><td class='tdbottom'></td><td class='tdbottom'></td><td class='tdbottom'></td><td class='tdbottom'></td><td class='tdbottom'></td></tr>
<tr class='magenta noborder'><td>Length:</td><td>0</td><td>1</td><td>2</td><td>3</td><td>4</td><td>5</td><td>6</td><td>7</td><td>8</td><td>9</td><td>10</td></tr>
</table>

<table>
<tr><td style="text-align:left;width:800px">
![](images/dp/log.webp){style="padding-left:135px;transform:scaleX(1.5);height:100px;width:100px;object-fit:cover;object-position:0% 0;border-right:5px solid blue"}
</td></tr>
</table>



## [3. Select a Good Order for Solving Subproblems]{.r-fit-text}

Solve Smallest subproblem first

::: {.fragment}
<table><tr><td style="padding:0;vertical-align:middle">
$${\color{magenta}Cut(3)} = \max
\begin{cases}
{\color{magenta}Cut(2)} + \color{blue}{P[1]} \\
{\color{magenta}Cut(1)} + \color{blue}{P[2]} \\
{\color{magenta}Cut(0)} + \color{blue}{P[3]} \\
\end{cases}$$
</td>
<td style="padding:0;vertical-align:bottom"><img src="images/spacer.png" style="min-height:265px;width:10px"></td>
</tr></table>
:::

<table class="cells">
<tr><td class='noborder bluetext'>Cut(i):</td><td class='tdbottom'>0</td><td class='tdbottom'></td><td class='tdbottom'></td><td class='tdbottom yellow'></td><td class='tdbottom'></td><td class='tdbottom'></td><td class='tdbottom'></td><td class='tdbottom'></td><td class='tdbottom'></td><td class='tdbottom'></td><td class='tdbottom'></td></tr>
<tr class='magenta noborder'><td>Length:</td><td>0</td><td>1</td><td>2</td><td>3</td><td>4</td><td>5</td><td>6</td><td>7</td><td>8</td><td>9</td><td>10</td></tr>
</table>

<table>
<tr><td style="text-align:left;width:800px">
![](images/dp/log.webp){style="padding-left:143px;transform:scaleX(1.5);height:100px;width:140px;object-fit:cover;object-position:0% 0;border-right:5px solid blue"}
</td></tr>
</table>


## [3. Select a Good Order for Solving Subproblems]{.r-fit-text}

Solve Smallest subproblem first

::: {.fragment}
<table><tr><td style="padding:0;vertical-align:middle;">
$${\color{magenta}Cut(4)} = \max
\begin{cases}
{\color{magenta}Cut(3)} + \color{blue}{P[1]} \\
{\color{magenta}Cut(2)} + \color{blue}{P[2]} \\
{\color{magenta}Cut(1)} + \color{blue}{P[3]} \\
{\color{magenta}Cut(0)} + \color{blue}{P[4]} \\
\end{cases}$$
</td>
<td style="padding:0;vertical-align:bottom"><img src="images/spacer.png" style="min-height:265px;width:10px"></td>
</tr></table>
:::

<table class="cells">
<tr><td class='noborder bluetext'>Cut(i):</td><td class='tdbottom'>0</td><td class='tdbottom'></td><td class='tdbottom'></td><td class='tdbottom'></td><td class='tdbottom yellow'></td><td class='tdbottom'></td><td class='tdbottom'></td><td class='tdbottom'></td><td class='tdbottom'></td><td class='tdbottom'></td><td class='tdbottom'></td></tr>
<tr class='magenta noborder'><td>Length:</td><td>0</td><td>1</td><td>2</td><td>3</td><td>4</td><td>5</td><td>6</td><td>7</td><td>8</td><td>9</td><td>10</td></tr>
</table>

<table>
<tr><td style="text-align:left;width:800px">
![](images/dp/log.webp){style="padding-left:151px;transform:scaleX(1.5);height:100px;width:180px;object-fit:cover;object-position:0% 0;border-right:5px solid blue"}
</td></tr>
</table>



## Log Cutting Pseudocode

::: {.no-bullets}
- Initialize Memory *profit*
- Cut(n):
  - profit[0] = 0
  - for i=1 to n:  <span class='grey'>// log size</span>
    - best = 0
    - for j = 1 to i: <span class='grey'>// last cut</span>
      - best = max(best, <span class='magenta'>profit[i-j]</span> + <span class='blue'>P[j]</span>)
    - profit[i] = best
  - return profit[n]
:::


::: {.fragment}
<span class='red'>Run time: $O(n^2)$</span>
:::



## How to find the cuts?

&nbsp;<br>

- This procedure told us the profit, but not the cuts themselves
- Idea: <span class='red'>remember</span> the choice that you made, then <span class='red'>backtrack</span>



## Remember the choice made

::: {.no-bullets}
- Initialize Memory *profit*, *choices*
- Cut(n):
  - profit[0] = 0
  - for i=1 to n:  <span class='grey'>// log size</span>
    - best = 0
    - for j = 1 to i: <span class='grey'>// last cut</span>
      - if best < <span class='magenta'>profit[i-j]</span> + <span class='blue'>P[j]</span>:
        - best = <span class='magenta'>profit[i-j]</span> + <span class='blue'>P[j]</span>
        - <span style="border:2px solid red; padding:5px">choices[i] = j</span> <span class='red'>// gives the size of the last cut</span>
      - profit[i] = best
  - return profit[n]
:::


## Reconstruct the Cuts

- Backtrack through the choices

<table class="compact"><tr>
<td style="width:160px"></td>
<td>
::: {.fragment fragment-index=9}
<div class="half-circle" style="width:55px;height:30px;border-top-left-radius: 70px;border-top-right-radius: 70px"></div>
:::
</td><td>
::: {.fragment fragment-index=7}
<div class="half-circle" style="width:55px;height:30px;border-top-left-radius: 70px;border-top-right-radius: 70px"></div>
:::
</td><td>
::: {.fragment fragment-index=5}
<div class="half-circle" style="width:220px;height:50px;border-top-left-radius: 70px;border-top-right-radius: 70px"></div>
:::
</td><td>
::: {.fragment fragment-index=3}
<div class="half-circle" style="width:55px;height:30px;border-top-left-radius: 70px;border-top-right-radius: 70px"></div>
:::
</td><td>
::: {.fragment fragment-index=1}
<div class="half-circle" style="width:165px;height:50px;border-top-left-radius: 70px;border-top-right-radius: 70px"></div>
:::
</td></tr></table>

<table class="cells">
<tr><td class='noborder bluetext'>Choices:</td><td class='tdbottom'>0</td><td class='tdbottom'>1</td><td class='tdbottom'>1</td><td class='tdbottom'>2</td><td class='tdbottom'>4</td><td class='tdbottom'>3</td><td class='tdbottom'>4</td><td class='tdbottom'>1</td><td class='tdbottom'>2</td><td class='tdbottom'>4</td><td class='tdbottom'>3</td></tr>
<tr class='magenta noborder'><td>Length:</td><td>0</td><td>1</td><td>2</td><td>3</td><td>4</td><td>5</td><td>6</td><td>7</td><td>8</td><td>9</td><td>10</td></tr>
</table>

::: {.r-stack}

::: {.center}
![](images/dp/log.webp){style="width:700px;padding-left:175px;height:150px"}
:::


<table class="compact"><tr>
<td style="width:120px"></td>
<td style="width:85px">
::: {.fragment fragment-index=8}
<table><tr><td style="border-left:5px solid red;height:150px"></td></tr></table>
:::
</td>
<td style="width:50px">
::: {.fragment fragment-index=6}
<table><tr><td style="border-left:5px solid red;height:150px"></td></tr></table>
:::
</td>
<td style="width:60px"></td>
<td style="width:60px"></td>
<td style="width:60px"></td>
<td style="width:85px">
::: {.fragment fragment-index=4}
<table><tr><td style="border-left:5px solid red;height:150px"></td></tr></table>
:::
</td>
<td style="width:50px">
::: {.fragment fragment-index=2}
<table><tr><td style="border-left:5px solid red;height:150px"></td></tr></table>
:::
</td>
<td style="width:50px"></td>
<td style="width:50px"></td>
</tr></table>

:::


&nbsp;

::: {.fragment fragment-index=10}
<table class="purplenote"><tr><td style="font-size:xx-large">Example to demo Choices[] only.<br>Profit of 20 is not optimal! </td></tr></table>
:::


## Backtracking Pseudocode

This is similar to the back link in Dijkstra's shortest path algorithm

&nbsp;

::: {.no-bullets}
- i = n
- while i > 0:
  - print choices[i]
  - i = i - choices[i]
:::



## [Our Example: Getting Optimal Solution]{.r-fit-text}

<div style="scale:70%">
<table class="cells">
<tr><td class='noborder bluetext'>Prices:</td><td class='tdbottom'>1</td><td class='tdbottom'>5</td><td class='tdbottom'>8</td><td class='tdbottom'>9</td><td class='tdbottom'>10</td><td class='tdbottom'>17</td><td class='tdbottom'>17</td><td class='tdbottom'>20</td><td class='tdbottom'>24</td><td class='tdbottom'>30</td></tr>
<tr class='magenta noborder'><td>Length:</td><td>1</td><td>2</td><td>3</td><td>4</td><td>5</td><td>6</td><td>7</td><td>8</td><td>9</td><td>10</td></tr>
</table>
</div>

::: {.blue-table}
| i | 0 | 1 | 2 | 3 | 4 | 5 | 6 | 7 | 8 | 9 | 10 |
|----|----|----|----|----|----|----|----|----|----|----|----|
| profit[i] | 0 | 1 | 5 | 8 | 10 | 13 | 17 | 18 | 22 | 25 | 30 |
| choice[i] | 0 | 1 | 2 | 3 | 2 | 2 | 6 | 1 | 2 | 3 | 10 |
:::

<div style="font-size:90%">

- If $n$ were 5
  - Best score is 13
  - Cut at choice[n]=2, then cut at<br>choice[n-choice[n]]= choice[5-2]= choice[3]=3
- If $n$ were 7
  - Best score is 18
  - Cut at 1, then cut at 6

</div>


## Dynamic Programming

- Requires <span class="magenta">Optimal Substructure</span>
	- Solution to larger problem contains the (optimal) solutions to smaller ones
- Idea:
	1. Identify recursive structure of the problem
		- What is the "last thing" done?
	2. Save the solution to each subproblem in memory
	3. Select a good order for solving subproblems
		- "Top Down": Solve each recursively
		- "Bottom Up": Iteratively solve smallest to largest


# Matrix Chaining <!-- from day17.pptx -->

::: {.titlereading}
Readings in CLRS 4th edition: chapter 14, specifically 14.2
:::



## Warm-Up

<p style="text-align:center">How many arithmetic operations are required to multiply a $n \times m$ matrix by a $m \times p$ matrix?</p>

<p style="text-align:center">(don't overthink this)</p>

<table class="allcenter">
  <tr>
  <td style="padding:0">
    <table>
		  <tr><td></td><td style="font-size:x-large">$m$</td></tr>
		  <tr>
			  <td style="font-size:x-large">$n$</td>
			  <td style="border:1px solid black;background-color:cornflowerblue;width:150px;height:100px"></td>
		  </tr>
	  </table>
  </td>
  <td style="padding:0">
    <table>
		  <tr><td></td><td style="font-size:x-large">$p$</td></tr>
		  <tr>
			  <td style="font-size:x-large">$\times$&nbsp;&nbsp;$m$</td>
			  <td style="border:1px solid black;background-color:cornflowerblue;width:50px;height:150px"></td>
		  </tr>
	  </table>
  </td>
</tr>
</table>

&nbsp;

::: {.fragment}
- $m$ multiplications and $m-1$ additions per element
- $n \cdot p$ elements to compute
- Total cost: $O(m \cdot n \cdot p)$
:::


## Matrix Chaining

- Given a sequence of matrices ($M_1, M_2, \ldots, M_n$), what is the most efficient way to multiply them?


<table class="allcenter">
  <tr>
  <td style="padding:0">
    <table class="allcenter">
		  <tr><td></td><td style="font-size:x-large">$c_1$</td></tr>
		  <tr>
			  <td style="font-size:x-large">$r_1$</td>
			  <td style="border:1px solid black;background-color:yellow;width:200px;height:100px">$M_1$</td>
		  </tr>
	  </table>
  </td>
  <td style="padding:0">
    <table class="allcenter">
		  <tr><td></td><td style="font-size:x-large">$c_2$</td></tr>
		  <tr>
			  <td style="font-size:x-large">$\times$&nbsp;&nbsp;$r_2$</td>
			  <td style="border:1px solid black;background-color:red;width:50px;height:200px">$M_2$</td>
		  </tr>
	  </table>
  </td>
  <td style="padding:0">
    <table class="allcenter">
		  <tr><td></td><td style="font-size:x-large">$c_3$</td></tr>
		  <tr>
			  <td style="font-size:x-large">$\times$&nbsp;&nbsp;$r_3$</td>
			  <td style="border:1px solid black;background-color:CornflowerBlue;width:200px;height:50px;color:white">$M_3$</td>
		  </tr>
	  </table>
  </td>
  <td style="padding:0">
    <table class="allcenter">
		  <tr><td></td><td style="font-size:x-large">$c_4$</td></tr>
		  <tr>
			  <td style="font-size:x-large">$\times$&nbsp;&nbsp;$r_4$</td>
			  <td style="border:1px solid black;background-color:green;width:100px;height:200px">$M_4$</td>
		  </tr>
	  </table>
  </td>
  </tr>
</table>



## Order Matters!

<table class="allcenter" style="width:70%">
  <tr>
  <td>
    <table>
		  <tr><td></td><td style="font-size:x-large">$c_1$</td></tr>
		  <tr>
			  <td style="font-size:x-large">$r_1$</td>
			  <td style="border:1px solid black;background-color:yellow;width:100px;height:50px">$M_1$</td>
		  </tr>
	  </table>
  </td>
  <td>$\times$</td>
  <td>
    <table>
		  <tr><td></td><td style="font-size:x-large">$c_2$</td></tr>
		  <tr>
			  <td style="font-size:x-large">$r_2$</td>
			  <td style="border:1px solid black;background-color:red;width:150px;height:100px">$M_2$</td>
		  </tr>
	  </table>
  </td>
  <td>$\times$</td>
  <td>
    <table>
		  <tr><td></td><td style="font-size:x-large">$c_3$</td></tr>
		  <tr>
			  <td style="font-size:x-large">$r_3$</td>
			  <td style="border:1px solid black;background-color:CornflowerBlue;width:50px;height:150px;color:white">$M_3$</td>
		  </tr>
	  </table>
  </td>
  </tr>

  <tr><td colspan='3'><img src="images/underbrace-red.svg" style="width:100%;min-height:40px;margin-bottom: -20px;padding-bottom: 0;margin-top: 0;"></td><td></td><td></td></tr>
  
  <tr><td colspan='3'>
    <table>
		  <tr><td></td><td style="font-size:x-large">$c_2$</td></tr>
		  <tr>
			  <td style="font-size:x-large">$r_1$</td>
			  <td style="border:1px solid black;background-color:orange;width:150px;height:50px;color:white"></td>
		  </tr>
	  </table>
  </td><td></td><td></td></tr>
</table>

&nbsp;

- Note that $c_1=r_2$ and $c_2=r_3$
- $($<span style="background-color:yellow">$M_1$</span> $\times$ <span style="background-color:red">$M_2$</span>$)$ $\times$ <span style="background-color:CornflowerBlue;color:white">$M_3$</span>
  - uses <span style="background-color:burlywood">$c_1 \cdot r_1 \cdot c_2$</span> + $c_2 \cdot r_1 \cdot c_3$</span> multiplications



## Order Matters!

<table class="allcenter" style="width:70%">
  <tr>
  <td>
    <table>
		  <tr><td></td><td style="font-size:x-large">$c_1$</td></tr>
		  <tr>
			  <td style="font-size:x-large">$r_1$</td>
			  <td style="border:1px solid black;background-color:yellow;width:100px;height:50px">$M_1$</td>
		  </tr>
	  </table>
  </td>
  <td>$\times$</td>
  <td>
    <table>
		  <tr><td></td><td style="font-size:x-large">$c_2$</td></tr>
		  <tr>
			  <td style="font-size:x-large">$r_2$</td>
			  <td style="border:1px solid black;background-color:red;width:150px;height:100px">$M_2$</td>
		  </tr>
	  </table>
  </td>
  <td>$\times$</td>
  <td>
    <table>
		  <tr><td></td><td style="font-size:x-large">$c_3$</td></tr>
		  <tr>
			  <td style="font-size:x-large">$r_3$</td>
			  <td style="border:1px solid black;background-color:CornflowerBlue;width:50px;height:150px;color:white">$M_3$</td>
		  </tr>
	  </table>
  </td>
  </tr>

  </tr>
  <tr><td></td><td></td><td colspan='3'><img src="images/underbrace-red.svg" style="width:100%;min-height:40px;margin-bottom: -20px;padding-bottom: 0;margin-top: 0;"></td></tr>

  <tr><td></td><td></td><td colspan='3'>
    <table>
		  <tr><td></td><td style="font-size:x-large">$c_3$</td></tr>
		  <tr>
			  <td style="font-size:x-large">$r_2$</td>
			  <td style="border:1px solid black;background-color:purple;width:50px;height:125px;color:white"></td>
		  </tr>
	  </table>
  </td></tr>
</table>


- Note that $c_1=r_2$ and $c_2=r_3$
- <span style="background-color:yellow">$M_1$</span> $\times$ $($<span style="background-color:red">$M_2$</span> $\times$ <span style="background-color:CornflowerBlue;color:white">$M_3$</span>$)$
  - uses $c_1 \cdot r_1 \cdot c_3$ + <span style="background-color:plum">$c_2 \cdot r_2 \cdot c_3$</span> multiplications




## Order Matters!

<table><tr><td style="vertical-align:top">

- Note that $c_1=r_2$ and $c_2=r_3$
- $($<span style="background-color:yellow">$M_1$</span> $\times$ <span style="background-color:red">$M_2$</span>$)$ $\times$ <span style="background-color:CornflowerBlue;color:white">$M_3$</span>
  - uses <span style="background-color:burlywood">$c_1 \cdot r_1 \cdot c_2$</span> + $c_2 \cdot r_1 \cdot c_3$</span> multiplications
  - $10 \cdot 7 \cdot 20 + 20 \cdot 7 \cdot 8 = 2520$
- <span style="background-color:yellow">$M_1$</span> $\times$ $($<span style="background-color:red">$M_2$</span> $\times$ <span style="background-color:CornflowerBlue;color:white">$M_3$</span>$)$
    - uses $c_1 \cdot r_1 \cdot c_3$ + <span style="background-color:plum">$c_2 \cdot r_2 \cdot c_3$</span> multiplications
    - $10 \cdot 7 \cdot 8 + 20 \cdot 10 \cdot 8 = 2160$

</td><td style="vertical-align:top">

::: {.no-bullets}
- $M_1=7 \times 10$
- $M_2=10 \times 20$
- $M_3 = 20 \times 8$

&nbsp;

- $c_1=10$
- $c_2=20$
- $c_3=8$
- $r_1=7$
- $r_2=10$
- $r_3=20$
:::

</td></tr></table>



## Dynamic Programming

- Requires <span class="magenta">Optimal Substructure</span>
	- Solution to larger problem contains the (optimal) solutions to smaller ones
- Idea:
<ol>
	<li class="purple">Identify recursive structure of the problem
    	<ul><li>What is the "last thing" done?</li></ul></li>
	<li>Save the solution to each subproblem in memory</li>
	<li>Select a good order for solving subproblems
		<ul>
			<li>"Top Down": Solve each recursively</li>
			<li>"Bottom Up": Iteratively solve smallest to largest</li>
		</ul></li>
</ol>


## [1. Identify the Recursive Structure of the Problem]{.r-fit-text}
$Best(1,n)$ = cheapest way to mult together $M_1$ through $M_n$

- Let $k$ be the *last* multiplication that is made
	- $k$ represents the $\times$ symbol *after* matrix $M_k$
- For $Best(1,10)$, if $k=5$, then:
  - We first multiply $M_1$ through $M_5$ together
  - We then multiply $M_6$ through $M_{10}$ together
  - Lastly, we multiply those two results together
- Formally, for $Best(i,j)$:
	- We multiply $M_i$ through $M_k$
	- We multiply $M_{k+1}$ through $M_j$
	- We multiply those two results together



## [1. Identify the Recursive Structure of the Problem]{.r-fit-text}
$Best(1,n)$ = cheapest way to mult together $M_1$ through $M_n$

<div style="font-size:80%;opacity:0">$$\color{magenta}{Best(1,4)} = \min
\begin{cases}
\color{magenta}{Best(2,4)} + r_1r_2c_4 \\
\ this formula is hidden \\
\  \\
\end{cases}$$</div>

<table class="allcenter" style="scale:80%;margin-top:-80px">

<tr>
  <td style="height:200px"></td>
  <td colspan="3">

<table class="allcenter">
  <tr><td></td><td style="font-size:x-large;opacity:0">$c_4$</td></tr>
  <tr>
	  <td style="font-size:x-large;opacity:0">$r_2$</td>
	  <td style="border:1px solid transparent;background-color:transparent;width:100px;height:150px"></td>
  </tr>
</table>

  </td>
</tr>

<tr>
  <td></td>
  <td colspan="3">
  	<img src="images/overbrace-red.svg" style="width:600px;min-height:40px;opacity:0;margin-bottom:-20px;margin-top:0">
  </td>
</tr>

  <tr>
  <td style="padding:0">
    <table class="allcenter">
		  <tr><td></td><td style="font-size:x-large">$c_1$</td></tr>
		  <tr>
			  <td style="font-size:x-large">$r_1$</td>
			  <td style="border:1px solid black;background-color:CornflowerBlue;width:200px;height:100px">$M_1$</td>
		  </tr>
	  </table>
  </td>
  <td style="padding:0">
    <table class="allcenter">
		  <tr><td></td><td style="font-size:x-large">$c_2$</td></tr>
		  <tr>
			  <td style="font-size:x-large">$\times$&nbsp;&nbsp;$r_2$</td>
			  <td style="border:1px solid black;background-color:CornflowerBlue;width:50px;height:200px">$M_2$</td>
		  </tr>
	  </table>
  </td>
  <td style="padding:0">
    <table class="allcenter">
		  <tr><td></td><td style="font-size:x-large">$c_3$</td></tr>
		  <tr>
			  <td style="font-size:x-large">$\times$&nbsp;&nbsp;$r_3$</td>
			  <td style="border:1px solid black;background-color:CornflowerBlue;width:200px;height:50px">$M_3$</td>
		  </tr>
	  </table>
  </td>
  <td style="padding:0">
    <table class="allcenter">
		  <tr><td></td><td style="font-size:x-large">$c_4$</td></tr>
		  <tr>
			  <td style="font-size:x-large">$\times$&nbsp;&nbsp;$r_4$</td>
			  <td style="border:1px solid black;background-color:CornflowerBlue;width:100px;height:200px">$M_4$</td>
		  </tr>
	  </table>
  </td>
  </tr>
</table>



## [1. Identify the Recursive Structure of the Problem]{.r-fit-text}
$Best(1,n)$ = cheapest way to mult together $M_1$ through $M_n$

<div style="font-size:80%">$$Best(1,4) = \min
\begin{cases}
{\color{green}Best(1,1)}+{\color{magenta}Best(2,4)} + r_1r_2c_4 \\
\  \\
\  \\
\end{cases}$$</div>

<table class="allcenter" style="scale:80%;margin-top:-80px">

<tr>
  <td style="height:200px"></td>
  <td colspan="3">

<table class="allcenter">
  <tr><td></td><td style="font-size:x-large">$c_4$</td></tr>
  <tr>
	  <td style="font-size:x-large">$r_2$</td>
	  <td style="border:1px solid black;background-color:magenta;width:100px;height:150px"></td>
  </tr>
</table>

  </td>
</tr>

<tr>
  <td></td>
  <td colspan="3">
  	<img src="images/overbrace-red.svg" style="width:600px;min-height:40px;margin-bottom:-20px;margin-top:0">
  </td>
</tr>

  <tr>
  <td style="padding:0">
    <table class="allcenter">
		  <tr><td></td><td style="font-size:x-large">$c_1$</td></tr>
		  <tr>
			  <td style="font-size:x-large">$r_1$</td>
			  <td style="border:1px solid black;background-color:green;width:200px;height:100px">$M_1$</td>
		  </tr>
	  </table>
  </td>
  <td style="padding:0">
    <table class="allcenter">
		  <tr><td></td><td style="font-size:x-large">$c_2$</td></tr>
		  <tr>
			  <td style="font-size:x-large">$\times$&nbsp;&nbsp;$r_2$</td>
			  <td style="border:1px solid black;background-color:CornflowerBlue;width:50px;height:200px">$M_2$</td>
		  </tr>
	  </table>
  </td>
  <td style="padding:0">
    <table class="allcenter">
		  <tr><td></td><td style="font-size:x-large">$c_3$</td></tr>
		  <tr>
			  <td style="font-size:x-large">$\times$&nbsp;&nbsp;$r_3$</td>
			  <td style="border:1px solid black;background-color:CornflowerBlue;width:200px;height:50px">$M_3$</td>
		  </tr>
	  </table>
  </td>
  <td style="padding:0">
    <table class="allcenter">
		  <tr><td></td><td style="font-size:x-large">$c_4$</td></tr>
		  <tr>
			  <td style="font-size:x-large">$\times$&nbsp;&nbsp;$r_4$</td>
			  <td style="border:1px solid black;background-color:CornflowerBlue;width:100px;height:200px">$M_4$</td>
		  </tr>
	  </table>
  </td>
  </tr>
</table>



## [1. Identify the Recursive Structure of the Problem]{.r-fit-text}
$Best(1,n)$ = cheapest way to mult together $M_1$ through $M_n$

<div style="font-size:80%">$$Best(1,4) = \min
\begin{cases}
{\color{green}Best(1,1)}+{\color{magenta}Best(2,4)} + r_1r_2c_4 \\
{\color{green}Best(1,2)} + {\color{magenta}Best(3,4)} + r_1r_3c_4 \\
\  \\
\end{cases}$$</div>

<table class="allcenter" style="scale:80%;margin-top:-80px">

<tr>
  <td colspan="2" style="height:200px">

<table class="allcenter">
  <tr><td></td><td style="font-size:x-large">$c_2$</td></tr>
  <tr>
	  <td style="font-size:x-large">$r_1$</td>
	  <td style="border:1px solid black;background-color:green;width:50px;height:150px"></td>
  </tr>
</table>

  </td>
  <td colspan="2">

<table class="allcenter">
  <tr><td></td><td style="font-size:x-large">$c_4$</td></tr>
  <tr>
	  <td style="font-size:x-large">$r_3$</td>
	  <td style="border:1px solid black;background-color:magenta;width:150px;height:50px"></td>
  </tr>
</table>

  </td>
</tr>

<tr>
  <td colspan="2">
  	<img src="images/overbrace-red.svg" style="width:400px;min-height:40px;margin-bottom:-20px;margin-top:0">
  </td>
  <td colspan="2">
  	<img src="images/overbrace-red.svg" style="width:400px;min-height:40px;margin-bottom:-20px;margin-top:0">
  </td>
</tr>

  <tr>
  <td style="padding:0">
    <table class="allcenter">
		  <tr><td></td><td style="font-size:x-large">$c_1$</td></tr>
		  <tr>
			  <td style="font-size:x-large">$r_1$</td>
			  <td style="border:1px solid black;background-color:CornflowerBlue;width:200px;height:100px">$M_1$</td>
		  </tr>
	  </table>
  </td>
  <td style="padding:0">
    <table class="allcenter">
		  <tr><td></td><td style="font-size:x-large">$c_2$</td></tr>
		  <tr>
			  <td style="font-size:x-large">$\times$&nbsp;&nbsp;$r_2$</td>
			  <td style="border:1px solid black;background-color:CornflowerBlue;width:50px;height:200px">$M_2$</td>
		  </tr>
	  </table>
  </td>
  <td style="padding:0">
    <table class="allcenter">
		  <tr><td></td><td style="font-size:x-large">$c_3$</td></tr>
		  <tr>
			  <td style="font-size:x-large">$\times$&nbsp;&nbsp;$r_3$</td>
			  <td style="border:1px solid black;background-color:CornflowerBlue;width:200px;height:50px">$M_3$</td>
		  </tr>
	  </table>
  </td>
  <td style="padding:0">
    <table class="allcenter">
		  <tr><td></td><td style="font-size:x-large">$c_4$</td></tr>
		  <tr>
			  <td style="font-size:x-large">$\times$&nbsp;&nbsp;$r_4$</td>
			  <td style="border:1px solid black;background-color:CornflowerBlue;width:100px;height:200px">$M_4$</td>
		  </tr>
	  </table>
  </td>
  </tr>
</table>



## [1. Identify the Recursive Structure of the Problem]{.r-fit-text}
$Best(1,n)$ = cheapest way to mult together $M_1$ through $M_n$

<div style="font-size:80%">$$Best(1,4) = \min
\begin{cases}
{\color{green}Best(1,1)}+{\color{magenta}Best(2,4)} + r_1r_2c_4 \\
{\color{green}Best(1,2)} + {\color{magenta}Best(3,4)} + r_1r_3c_4 \\
{\color{green}Best(1,3)} + {\color{magenta}Best(4,4)} + r_1r_4c_4 \\
\end{cases}$$</div>

<table class="allcenter" style="scale:80%;margin-top:-80px">

<tr>
  <td colspan="3">

<table class="allcenter">
  <tr><td></td><td style="font-size:x-large">$c_3$</td></tr>
  <tr>
	  <td style="font-size:x-large">$r_1$</td>
	  <td style="border:1px solid black;background-color:green;width:100px;height:150px"></td>
  </tr>
</table>

  </td>
  <td style="height:200px"></td>
</tr>

<tr>
  <td colspan="3">
  	<img src="images/overbrace-red.svg" style="width:600px;min-height:40px;margin-bottom:-20px;margin-top:0">
  </td>
  <td></td>
</tr>

  <tr>
  <td style="padding:0">
    <table class="allcenter">
		  <tr><td></td><td style="font-size:x-large">$c_1$</td></tr>
		  <tr>
			  <td style="font-size:x-large">$r_1$</td>
			  <td style="border:1px solid black;background-color:CornflowerBlue;width:200px;height:100px">$M_1$</td>
		  </tr>
	  </table>
  </td>
  <td style="padding:0">
    <table class="allcenter">
		  <tr><td></td><td style="font-size:x-large">$c_2$</td></tr>
		  <tr>
			  <td style="font-size:x-large">$\times$&nbsp;&nbsp;$r_2$</td>
			  <td style="border:1px solid black;background-color:CornflowerBlue;width:50px;height:200px">$M_2$</td>
		  </tr>
	  </table>
  </td>
  <td style="padding:0">
    <table class="allcenter">
		  <tr><td></td><td style="font-size:x-large">$c_3$</td></tr>
		  <tr>
			  <td style="font-size:x-large">$\times$&nbsp;&nbsp;$r_3$</td>
			  <td style="border:1px solid black;background-color:CornflowerBlue;width:200px;height:50px">$M_3$</td>
		  </tr>
	  </table>
  </td>
  <td style="padding:0">
    <table class="allcenter">
		  <tr><td></td><td style="font-size:x-large">$c_4$</td></tr>
		  <tr>
			  <td style="font-size:x-large">$\times$&nbsp;&nbsp;$r_4$</td>
			  <td style="border:1px solid black;background-color:magenta;width:100px;height:200px">$M_4$</td>
		  </tr>
	  </table>
  </td>
  </tr>
</table>



## [1. Identify the Recursive Structure of the Problem]{.r-fit-text}

In general:

$Best(i,j)$ = cheapest way to multiply together $M_i$ through $M_j$

::: {.fragment}
$Best(i,j) = \min_{k=i}^{j-1} \left( {\color{green}Best(i,k)} + {\color{magenta}Best(k+1,j)}+r_ir_{k+1}c_j \right)$

$Best(i,i)=0$
:::

::: {.fragment}
$Best(1,n) = \min
\begin{cases}
{\color{green}Best(1,1)} + {\color{magenta}Best(2,n)} + r_1r_2c_n \\
{\color{green}Best(1,2)} + {\color{magenta}Best(3,n)} + r_1r_3c_n \\
{\color{green}Best(1,3)} + {\color{magenta}Best(4,n)} + r_1r_4c_n \\
{\color{green}Best(1,4)} + {\color{magenta}Best(5,n)} + r_1r_5c_n \\
\ldots \\
{\color{green}Best(1,n-1)} + {\color{magenta}Best(n,n)} + r_1r_nc_n \\
\end{cases}$
:::


## Dynamic Programming

- Requires <span class="magenta">Optimal Substructure</span>
	- Solution to larger problem contains the (optimal) solutions to smaller ones
- Idea:
<ol>
	<li>Identify recursive structure of the problem
    	<ul><li>What is the "last thing" done?</li></ul></li>
	<li class="purple">Save the solution to each subproblem in memory</li>
	<li>Select a good order for solving subproblems
		<ul>
			<li>"Top Down": Solve each recursively</li>
			<li>"Bottom Up": Iteratively solve smallest to largest</li>
		</ul></li>
</ol>


## 2. Save Subsolutions in Memory


<div style="font-size:80%">

In general:

$Best(i,j)$ = cheapest way to multiply together $M_i$ through $M_j$

::: {.fragment}
- <span class='red'>If $Best(i,j)$ is in memory, read it and done</span>
:::

$Best(i,j) = \min_{k=i}^{j-1} \left( {\color{green}Best(i,k)} + {\color{magenta}Best(k+1,j)}+r_ir_{k+1}c_j \right)$

::: {.fragment}
- <span class='red'>Read</span> $\color{green}{Best(i,k)}$ <span class='red'>and/or</span> $\color{magenta}{Best(k+1,j)}$ <span class='red'>from memory, if available</span>
- <span class='red'>Save computed $Best(i,j)$ to memory</span>
:::

$Best(i,i)=0$

$Best(1,n) = \min
\begin{cases}
{\color{green}Best(1,1)} + {\color{magenta}Best(2,n)} + r_1r_2c_n \\
{\color{green}Best(1,2)} + {\color{magenta}Best(3,n)} + r_1r_3c_n \\
{\color{green}Best(1,3)} + {\color{magenta}Best(4,n)} + r_1r_4c_n \\
{\color{green}Best(1,4)} + {\color{magenta}Best(5,n)} + r_1r_5c_n \\
\ldots \\
{\color{green}Best(1,n-1)} + {\color{magenta}Best(n,n)} + r_1r_nc_n \\
\end{cases}$

</div>




## Dynamic Programming

- Requires <span class="magenta">Optimal Substructure</span>
	- Solution to larger problem contains the (optimal) solutions to smaller ones
- Idea:
<ol>
	<li>Identify recursive structure of the problem
    	<ul><li>What is the "last thing" done?</li></ul></li>
	<li>Save the solution to each subproblem in memory</li>
	<li class="purple">Select a good order for solving subproblems
		<ul>
			<li>"Top Down": Solve each recursively</li>
			<li>"Bottom Up": Iteratively solve smallest to largest</li>
		</ul></li>
</ol>



## [3. Select a good order for solving subproblems]{.r-fit-text}

<div style="font-size:80%">

In general:

$Best(i,j)$ = cheapest way to multiply together $M_i$ through $M_j$

- <span class='red'>If $Best(i,j)$ is in memory, read it and done</span>

$Best(i,j) = \min_{k=i}^{j-1} \left( \color{green}{Best(i,k)} + \color{magenta}{Best(k+1,j)}+r_ir_{k+1}c_j \right)$

- <span class='red'>Read</span> $\color{green}{Best(i,k)}$ <span class='red'>and/or</span> $\color{magenta}{Best(k+1,j)}$ <span class='red'>from memory, if available</span>
- <span class='red'>Save computed $Best(i,j)$ to memory</span>

$Best(i,i)=0$

$Best(1,n) = \min
\begin{cases}
{\color{green}Best(1,1)} + {\color{magenta}Best(2,n)} + r_1r_2c_n \\
{\color{green}Best(1,2)} + {\color{magenta}Best(3,n)} + r_1r_3c_n \\
{\color{green}Best(1,3)} + {\color{magenta}Best(4,n)} + r_1r_4c_n \\
{\color{green}Best(1,4)} + {\color{magenta}Best(5,n)} + r_1r_5c_n \\
\ldots \\
{\color{green}Best(1,n-1)} + {\color{magenta}Best(n,n)} + r_1r_nc_n \\
\end{cases}$

</div>



## [3. Select a good order for solving subproblems]{.r-fit-text}
<table class="allcenter">
  <tr>
  <td style="padding:0">
    <table class="allcenter">
		  <tr><td></td><td style="font-size:large">$35$</td></tr>
		  <tr>
			  <td style="font-size:large">$30$</td>
			  <td style="font-size:large;border:1px solid black;background-color:cornflowerblue;height:60px;width:70px">$M_1$</td>
		  </tr>
	  </table>
  </td>
  <td style="padding:0">&nbsp;$\times$</td>
  <td style="padding:0">
    <table class="allcenter">
		  <tr><td></td><td style="font-size:large">$15$</td></tr>
		  <tr>
			  <td style="font-size:large">$35$</td>
			  <td style="font-size:large;border:1px solid black;background-color:cornflowerblue;height:70px;width:30px">$M_2$</td>
		  </tr>
	  </table>
  </td>
  <td style="padding:0">&nbsp;$\times$</td>
  <td style="padding:0">
    <table class="allcenter">
		  <tr><td></td><td style="font-size:large">$5$</td></tr>
		  <tr>
			  <td style="font-size:large">$15$</td>
			  <td style="font-size:large;border:1px solid black;background-color:cornflowerblue;height:30px;width:10px">$M_3$</td>
		  </tr>
	  </table>
  </td>
  <td style="padding:0">&nbsp;$\times$</td>
  <td style="padding:0">
    <table class="allcenter">
		  <tr><td></td><td style="font-size:large">$10$</td></tr>
		  <tr>
			  <td style="font-size:large">$5$</td>
			  <td style="font-size:large;border:1px solid black;background-color:cornflowerblue;height:10px;width:20px">$M_4$</td>
		  </tr>
	  </table>
  </td>
  <td style="padding:0">&nbsp;$\times$</td>
  <td style="padding:0">
    <table class="allcenter">
		  <tr><td></td><td style="font-size:large">$20$</td></tr>
		  <tr>
			  <td style="font-size:large">$10$</td>
			  <td style="font-size:large;border:1px solid black;background-color:cornflowerblue;height:20px;width:40px">$M_5$</td>
		  </tr>
	  </table>
  </td>
  <td style="padding:0">&nbsp;$\times$</td>
  <td style="padding:0">
    <table class="allcenter">
		  <tr><td></td><td style="font-size:large">$25$</td></tr>
		  <tr>
			  <td style="font-size:large">$20$</td>
			  <td style="font-size:large;border:1px solid black;background-color:cornflowerblue;height:40px;width:50px">$M_6$</td>
		  </tr>
	  </table>
  </td>
  </tr>
</table>

::: {.fragment}
<!-- first of these slides -->
$\scriptsize Best(i,j) = \min_{k=i}^{j-1} \left( {\color{green}Best(i,k)} + {\color{magenta}Best(k+1,j)}+r_ir_{k+1}c_j \right)$<br>
$\scriptsize Best(i,i)=0$
:::

<table class="allcenter" style="margin-top:-20px">
<tr><td style="width:50%;text-align:left;font-size:50%">
<!-- formula here -->
</td>
<td style="width:50%">
<table class="allcenter" style="font-size:90%">
<tr><td>$j=$</td><td>$1$</td><td>$2$</td><td>$3$</td><td>$4$</td><td>$5$</td><td>$6$</td><td></td><td></td></tr>
<tr><td></td><td class="border">0</td><td class="border"></td><td class="border"></td><td class="border"></td><td class="border"></td><td class="border"></td><td>1</td><td></td></tr>
<tr><td></td><td></td><td class="border">0</td><td class="border"></td><td class="border"></td><td class="border"></td><td class="border"></td><td>2</td><td></td></tr>
<tr><td></td><td></td><td></td><td class="border">0</td><td class="border"></td><td class="border"></td><td class="border"></td><td>3</td><td>$=i$</td></tr>
<tr><td></td><td></td><td></td><td></td><td class="border">0</td><td class="border"></td><td class="border"></td><td>4</td><td></td></tr>
<tr><td></td><td></td><td></td><td></td><td></td><td class="border">0</td><td class="border"></td><td>5</td><td></td></tr>
<tr><td></td><td></td><td></td><td></td><td></td><td></td><td class="border">0</td><td>6</td><td></td></tr>
</table>
</td></tr></table>


## [3. Select a good order for solving subproblems]{.r-fit-text}
<table class="allcenter">
  <tr>
  <td style="padding:0">
    <table class="allcenter">
		  <tr><td></td><td style="font-size:large">$35$</td></tr>
		  <tr>
			  <td style="font-size:large">$30$</td>
			  <td style="font-size:large;border:1px solid black;background-color:yellow;height:60px;width:70px">$M_1$</td>
		  </tr>
	  </table>
  </td>
  <td style="padding:0">&nbsp;$\times$</td>
  <td style="padding:0">
    <table class="allcenter">
		  <tr><td></td><td style="font-size:large">$15$</td></tr>
		  <tr>
			  <td style="font-size:large">$35$</td>
			  <td style="font-size:large;border:1px solid black;background-color:yellow;height:70px;width:30px">$M_2$</td>
		  </tr>
	  </table>
  </td>
  <td style="padding:0">&nbsp;$\times$</td>
  <td style="padding:0">
    <table class="allcenter">
		  <tr><td></td><td style="font-size:large">$5$</td></tr>
		  <tr>
			  <td style="font-size:large">$15$</td>
			  <td style="font-size:large;border:1px solid black;background-color:cornflowerblue;height:30px;width:10px">$M_3$</td>
		  </tr>
	  </table>
  </td>
  <td style="padding:0">&nbsp;$\times$</td>
  <td style="padding:0">
    <table class="allcenter">
		  <tr><td></td><td style="font-size:large">$10$</td></tr>
		  <tr>
			  <td style="font-size:large">$5$</td>
			  <td style="font-size:large;border:1px solid black;background-color:cornflowerblue;height:10px;width:20px">$M_4$</td>
		  </tr>
	  </table>
  </td>
  <td style="padding:0">&nbsp;$\times$</td>
  <td style="padding:0">
    <table class="allcenter">
		  <tr><td></td><td style="font-size:large">$20$</td></tr>
		  <tr>
			  <td style="font-size:large">$10$</td>
			  <td style="font-size:large;border:1px solid black;background-color:cornflowerblue;height:20px;width:40px">$M_5$</td>
		  </tr>
	  </table>
  </td>
  <td style="padding:0">&nbsp;$\times$</td>
  <td style="padding:0">
    <table class="allcenter">
		  <tr><td></td><td style="font-size:large">$25$</td></tr>
		  <tr>
			  <td style="font-size:large">$20$</td>
			  <td style="font-size:large;border:1px solid black;background-color:cornflowerblue;height:40px;width:50px">$M_6$</td>
		  </tr>
	  </table>
  </td>
  </tr>
</table>

$\scriptsize Best(i,j) = \min_{k=i}^{j-1} \left( {\color{green}Best(i,k)} + {\color{magenta}Best(k+1,j)}+r_ir_{k+1}c_j \right)$<br>
$\scriptsize Best(i,i)=0$

<table class="allcenter" style="margin-top:-20px">
<tr><td style="width:50%;text-align:center;font-size:75%">
$\small Best(1,2) = \min$<br>&nbsp;<br>
$\small \begin{cases}
\  \\
\  \\
{\color{green}Best(1,1)} + {\color{magenta}Best(2,2)} + r_1r_2c_2 \\
\  \\
\  \\
\end{cases}$
</td>
<td style="width:50%">
<table class="allcenter" style="font-size:90%">
<tr><td>$j=$</td><td>$1$</td><td>$2$</td><td>$3$</td><td>$4$</td><td>$5$</td><td>$6$</td><td></td><td></td></tr>
<tr><td></td><td class="border">0</td><td class="border yellow" style="font-size:small">15750</td><td class="border"></td><td class="border"></td><td class="border"></td><td class="border"></td><td>1</td><td></td></tr>
<tr><td></td><td></td><td class="border">0</td><td class="border"></td><td class="border"></td><td class="border"></td><td class="border"></td><td>2</td><td></td></tr>
<tr><td></td><td></td><td></td><td class="border">0</td><td class="border"></td><td class="border"></td><td class="border"></td><td>3</td><td>$=i$</td></tr>
<tr><td></td><td></td><td></td><td></td><td class="border">0</td><td class="border"></td><td class="border"></td><td>4</td><td></td></tr>
<tr><td></td><td></td><td></td><td></td><td></td><td class="border">0</td><td class="border"></td><td>5</td><td></td></tr>
<tr><td></td><td></td><td></td><td></td><td></td><td></td><td class="border">0</td><td>6</td><td></td></tr>
</table>
</td></tr></table>


## [3. Select a good order for solving subproblems]{.r-fit-text}
<table class="allcenter">
  <tr>
  <td style="padding:0">
    <table class="allcenter">
		  <tr><td></td><td style="font-size:large">$35$</td></tr>
		  <tr>
			  <td style="font-size:large">$30$</td>
			  <td style="font-size:large;border:1px solid black;background-color:cornflowerblue;height:60px;width:70px">$M_1$</td>
		  </tr>
	  </table>
  </td>
  <td style="padding:0">&nbsp;$\times$</td>
  <td style="padding:0">
    <table class="allcenter">
		  <tr><td></td><td style="font-size:large">$15$</td></tr>
		  <tr>
			  <td style="font-size:large">$35$</td>
			  <td style="font-size:large;border:1px solid black;background-color:yellow;height:70px;width:30px">$M_2$</td>
		  </tr>
	  </table>
  </td>
  <td style="padding:0">&nbsp;$\times$</td>
  <td style="padding:0">
    <table class="allcenter">
		  <tr><td></td><td style="font-size:large">$5$</td></tr>
		  <tr>
			  <td style="font-size:large">$15$</td>
			  <td style="font-size:large;border:1px solid black;background-color:yellow;height:30px;width:10px">$M_3$</td>
		  </tr>
	  </table>
  </td>
  <td style="padding:0">&nbsp;$\times$</td>
  <td style="padding:0">
    <table class="allcenter">
		  <tr><td></td><td style="font-size:large">$10$</td></tr>
		  <tr>
			  <td style="font-size:large">$5$</td>
			  <td style="font-size:large;border:1px solid black;background-color:cornflowerblue;height:10px;width:20px">$M_4$</td>
		  </tr>
	  </table>
  </td>
  <td style="padding:0">&nbsp;$\times$</td>
  <td style="padding:0">
    <table class="allcenter">
		  <tr><td></td><td style="font-size:large">$20$</td></tr>
		  <tr>
			  <td style="font-size:large">$10$</td>
			  <td style="font-size:large;border:1px solid black;background-color:cornflowerblue;height:20px;width:40px">$M_5$</td>
		  </tr>
	  </table>
  </td>
  <td style="padding:0">&nbsp;$\times$</td>
  <td style="padding:0">
    <table class="allcenter">
		  <tr><td></td><td style="font-size:large">$25$</td></tr>
		  <tr>
			  <td style="font-size:large">$20$</td>
			  <td style="font-size:large;border:1px solid black;background-color:cornflowerblue;height:40px;width:50px">$M_6$</td>
		  </tr>
	  </table>
  </td>
  </tr>
</table>

$\scriptsize Best(i,j) = \min_{k=i}^{j-1} \left( {\color{green}Best(i,k)} + {\color{magenta}Best(k+1,j)}+r_ir_{k+1}c_j \right)$<br>
$\scriptsize Best(i,i)=0$

<table class="allcenter" style="margin-top:-20px">
<tr><td style="width:50%;text-align:center;font-size:75%">
$\small Best(2,3) = \min$<br>&nbsp;<br>
$\small \begin{cases}
\  \\
\  \\
{\color{green}Best(2,2)} + {\color{magenta}Best(3,3)} + r_2r_3c_3 \\
\  \\
\  \\
\end{cases}$
</td>
<td style="width:50%">
<table class="allcenter" style="font-size:90%">
<tr><td>$j=$</td><td>$1$</td><td>$2$</td><td>$3$</td><td>$4$</td><td>$5$</td><td>$6$</td><td></td><td></td></tr>
<tr><td></td><td class="border">0</td><td class="border" style="font-size:small">15750</td><td class="border"></td><td class="border"></td><td class="border"></td><td class="border"></td><td>1</td><td></td></tr>
<tr><td></td><td></td><td class="border">0</td><td class="border yellow" style="font-size:small">2625</td><td class="border"></td><td class="border"></td><td class="border"></td><td>2</td><td></td></tr>
<tr><td></td><td></td><td></td><td class="border">0</td><td class="border"></td><td class="border"></td><td class="border"></td><td>3</td><td>$=i$</td></tr>
<tr><td></td><td></td><td></td><td></td><td class="border">0</td><td class="border"></td><td class="border"></td><td>4</td><td></td></tr>
<tr><td></td><td></td><td></td><td></td><td></td><td class="border">0</td><td class="border"></td><td>5</td><td></td></tr>
<tr><td></td><td></td><td></td><td></td><td></td><td></td><td class="border">0</td><td>6</td><td></td></tr>
</table>
</td></tr></table>


## [3. Select a good order for solving subproblems]{.r-fit-text}
<table class="allcenter">
  <tr>
  <td style="padding:0">
    <table class="allcenter">
		  <tr><td></td><td style="font-size:large">$35$</td></tr>
		  <tr>
			  <td style="font-size:large">$30$</td>
			  <td style="font-size:large;border:1px solid black;background-color:cornflowerblue;height:60px;width:70px">$M_1$</td>
		  </tr>
	  </table>
  </td>
  <td style="padding:0">&nbsp;$\times$</td>
  <td style="padding:0">
    <table class="allcenter">
		  <tr><td></td><td style="font-size:large">$15$</td></tr>
		  <tr>
			  <td style="font-size:large">$35$</td>
			  <td style="font-size:large;border:1px solid black;background-color:cornflowerblue;height:70px;width:30px">$M_2$</td>
		  </tr>
	  </table>
  </td>
  <td style="padding:0">&nbsp;$\times$</td>
  <td style="padding:0">
    <table class="allcenter">
		  <tr><td></td><td style="font-size:large">$5$</td></tr>
		  <tr>
			  <td style="font-size:large">$15$</td>
			  <td style="font-size:large;border:1px solid black;background-color:cornflowerblue;height:30px;width:10px">$M_3$</td>
		  </tr>
	  </table>
  </td>
  <td style="padding:0">&nbsp;$\times$</td>
  <td style="padding:0">
    <table class="allcenter">
		  <tr><td></td><td style="font-size:large">$10$</td></tr>
		  <tr>
			  <td style="font-size:large">$5$</td>
			  <td style="font-size:large;border:1px solid black;background-color:cornflowerblue;height:10px;width:20px">$M_4$</td>
		  </tr>
	  </table>
  </td>
  <td style="padding:0">&nbsp;$\times$</td>
  <td style="padding:0">
    <table class="allcenter">
		  <tr><td></td><td style="font-size:large">$20$</td></tr>
		  <tr>
			  <td style="font-size:large">$10$</td>
			  <td style="font-size:large;border:1px solid black;background-color:cornflowerblue;height:20px;width:40px">$M_5$</td>
		  </tr>
	  </table>
  </td>
  <td style="padding:0">&nbsp;$\times$</td>
  <td style="padding:0">
    <table class="allcenter">
		  <tr><td></td><td style="font-size:large">$25$</td></tr>
		  <tr>
			  <td style="font-size:large">$20$</td>
			  <td style="font-size:large;border:1px solid black;background-color:cornflowerblue;height:40px;width:50px">$M_6$</td>
		  </tr>
	  </table>
  </td>
  </tr>
</table>

$\scriptsize Best(i,j) = \min_{k=i}^{j-1} \left( {\color{green}Best(i,k)} + {\color{magenta}Best(k+1,j)}+r_ir_{k+1}c_j \right)$<br>
$\scriptsize Best(i,i)=0$

<table class="allcenter" style="margin-top:-20px">
<tr><td style="width:50%;text-align:left;font-size:50%">
<!-- formula here -->
</td>
<td style="width:50%">
<table class="allcenter" style="font-size:90%">
<tr><td>$j=$</td><td>$1$</td><td>$2$</td><td>$3$</td><td>$4$</td><td>$5$</td><td>$6$</td><td></td><td></td></tr>
<tr><td></td><td class="border">0</td><td class="border" style="font-size:small">15750</td><td class="border"></td><td class="border"></td><td class="border"></td><td class="border"></td><td>1</td><td></td></tr>
<tr><td></td><td></td><td class="border">0</td><td class="border" style="font-size:small">2625</td><td class="border"></td><td class="border"></td><td class="border"></td><td>2</td><td></td></tr>
<tr><td></td><td></td><td></td><td class="border">0</td><td class="border" style="font-size:small">750</td><td class="border"></td><td class="border"></td><td>3</td><td>$=i$</td></tr>
<tr><td></td><td></td><td></td><td></td><td class="border">0</td><td class="border" style="font-size:small">1000</td><td class="border"></td><td>4</td><td></td></tr>
<tr><td></td><td></td><td></td><td></td><td></td><td class="border">0</td><td class="border" style="font-size:small">5000</td><td>5</td><td></td></tr>
<tr><td></td><td></td><td></td><td></td><td></td><td></td><td class="border">0</td><td>6</td><td></td></tr>
</table>
</td></tr></table>


## [3. Select a good order for solving subproblems]{.r-fit-text}
<table class="allcenter">
  <tr>
  <td style="padding:0">
    <table class="allcenter">
		  <tr><td></td><td style="font-size:large">$35$</td></tr>
		  <tr>
			  <td style="font-size:large">$30$</td>
			  <td style="font-size:large;border:1px solid black;background-color:yellow;height:60px;width:70px">$M_1$</td>
		  </tr>
	  </table>
  </td>
  <td style="padding:0">&nbsp;$\times$</td>
  <td style="padding:0">
    <table class="allcenter">
		  <tr><td></td><td style="font-size:large">$15$</td></tr>
		  <tr>
			  <td style="font-size:large">$35$</td>
			  <td style="font-size:large;border:1px solid black;background-color:yellow;height:70px;width:30px">$M_2$</td>
		  </tr>
	  </table>
  </td>
  <td style="padding:0">&nbsp;$\times$</td>
  <td style="padding:0">
    <table class="allcenter">
		  <tr><td></td><td style="font-size:large">$5$</td></tr>
		  <tr>
			  <td style="font-size:large">$15$</td>
			  <td style="font-size:large;border:1px solid black;background-color:yellow;height:30px;width:10px">$M_3$</td>
		  </tr>
	  </table>
  </td>
  <td style="padding:0">&nbsp;$\times$</td>
  <td style="padding:0">
    <table class="allcenter">
		  <tr><td></td><td style="font-size:large">$10$</td></tr>
		  <tr>
			  <td style="font-size:large">$5$</td>
			  <td style="font-size:large;border:1px solid black;background-color:cornflowerblue;height:10px;width:20px">$M_4$</td>
		  </tr>
	  </table>
  </td>
  <td style="padding:0">&nbsp;$\times$</td>
  <td style="padding:0">
    <table class="allcenter">
		  <tr><td></td><td style="font-size:large">$20$</td></tr>
		  <tr>
			  <td style="font-size:large">$10$</td>
			  <td style="font-size:large;border:1px solid black;background-color:cornflowerblue;height:20px;width:40px">$M_5$</td>
		  </tr>
	  </table>
  </td>
  <td style="padding:0">&nbsp;$\times$</td>
  <td style="padding:0">
    <table class="allcenter">
		  <tr><td></td><td style="font-size:large">$25$</td></tr>
		  <tr>
			  <td style="font-size:large">$20$</td>
			  <td style="font-size:large;border:1px solid black;background-color:cornflowerblue;height:40px;width:50px">$M_6$</td>
		  </tr>
	  </table>
  </td>
  </tr>
</table>

$\scriptsize Best(i,j) = \min_{k=i}^{j-1} \left( {\color{green}Best(i,k)} + {\color{magenta}Best(k+1,j)}+r_ir_{k+1}c_j \right)$<br>
$\scriptsize Best(i,i)=0$

<table class="allcenter" style="margin-top:-20px">
<tr><td style="width:50%;text-align:center;font-size:75%">

::: {.fragment fragment-index=1}
$r_1r_2c_3=30 \cdot 35 \cdot 5=5250$<br>
:::
::: {.fragment fragment-index=2}
$r_1r_3c_3=30 \cdot 15 \cdot 5=2250$<br>
:::

&nbsp;

::: {.r-stack}
::: {.fragment fragment-index=3}
$\small Best(1,3) = \min$<br>&nbsp;<br>
$\small \begin{cases}
\  (\text{below: }0+2625+5250=7875) \\
{\color{green}Best(1,1)} + {\color{magenta}Best(2,3)} + r_1r_2c_3 \\
{\color{green}Best(1,2)} + {\color{magenta}Best(3,3)} + r_1r_3c_3 \\
\  (\text{above: }15750+0+2250=18000) \\
\ \\
\end{cases}$
:::

::: {.fragment fragment-index=3 .fade-out}
$\small Best(1,3) = \min$<br>&nbsp;<br>
$\small \begin{cases}
\ \\
{\color{green}Best(1,1)} + {\color{magenta}Best(2,3)} + r_1r_2c_3 \\
{\color{green}Best(1,2)} + {\color{magenta}Best(3,3)} + r_1r_3c_3 \\
\ \\
\ \\
\end{cases}$
:::
:::

</td>
<td style="width:50%">
<table class="allcenter" style="font-size:90%">
<tr><td>$j=$</td><td>$1$</td><td>$2$</td><td>$3$</td><td>$4$</td><td>$5$</td><td>$6$</td><td></td><td></td></tr>
<tr><td></td><td class="border">0</td><td class="border" style="font-size:small">15750</td><td class="border yellow" style="font-size:small">
::: {.fragment fragment-index=4}
7875
:::
</td><td class="border"></td><td class="border"></td><td class="border"></td><td>1</td><td></td></tr>
<tr><td></td><td></td><td class="border">0</td><td class="border" style="font-size:small">2625</td><td class="border"></td><td class="border"></td><td class="border"></td><td>2</td><td></td></tr>
<tr><td></td><td></td><td></td><td class="border">0</td><td class="border" style="font-size:small">750</td><td class="border"></td><td class="border"></td><td>3</td><td>$=i$</td></tr>
<tr><td></td><td></td><td></td><td></td><td class="border">0</td><td class="border" style="font-size:small">1000</td><td class="border"></td><td>4</td><td></td></tr>
<tr><td></td><td></td><td></td><td></td><td></td><td class="border">0</td><td class="border" style="font-size:small">5000</td><td>5</td><td></td></tr>
<tr><td></td><td></td><td></td><td></td><td></td><td></td><td class="border">0</td><td>6</td><td></td></tr>
</table>
</td></tr></table>


## [3. Select a good order for solving subproblems]{.r-fit-text}
<table class="allcenter">
  <tr>
  <td style="padding:0">
    <table class="allcenter">
		  <tr><td></td><td style="font-size:large">$35$</td></tr>
		  <tr>
			  <td style="font-size:large">$30$</td>
			  <td style="font-size:large;border:1px solid black;background-color:cornflowerblue;height:60px;width:70px">$M_1$</td>
		  </tr>
	  </table>
  </td>
  <td style="padding:0">&nbsp;$\times$</td>
  <td style="padding:0">
    <table class="allcenter">
		  <tr><td></td><td style="font-size:large">$15$</td></tr>
		  <tr>
			  <td style="font-size:large">$35$</td>
			  <td style="font-size:large;border:1px solid black;background-color:cornflowerblue;height:70px;width:30px">$M_2$</td>
		  </tr>
	  </table>
  </td>
  <td style="padding:0">&nbsp;$\times$</td>
  <td style="padding:0">
    <table class="allcenter">
		  <tr><td></td><td style="font-size:large">$5$</td></tr>
		  <tr>
			  <td style="font-size:large">$15$</td>
			  <td style="font-size:large;border:1px solid black;background-color:cornflowerblue;height:30px;width:10px">$M_3$</td>
		  </tr>
	  </table>
  </td>
  <td style="padding:0">&nbsp;$\times$</td>
  <td style="padding:0">
    <table class="allcenter">
		  <tr><td></td><td style="font-size:large">$10$</td></tr>
		  <tr>
			  <td style="font-size:large">$5$</td>
			  <td style="font-size:large;border:1px solid black;background-color:cornflowerblue;height:10px;width:20px">$M_4$</td>
		  </tr>
	  </table>
  </td>
  <td style="padding:0">&nbsp;$\times$</td>
  <td style="padding:0">
    <table class="allcenter">
		  <tr><td></td><td style="font-size:large">$20$</td></tr>
		  <tr>
			  <td style="font-size:large">$10$</td>
			  <td style="font-size:large;border:1px solid black;background-color:cornflowerblue;height:20px;width:40px">$M_5$</td>
		  </tr>
	  </table>
  </td>
  <td style="padding:0">&nbsp;$\times$</td>
  <td style="padding:0">
    <table class="allcenter">
		  <tr><td></td><td style="font-size:large">$25$</td></tr>
		  <tr>
			  <td style="font-size:large">$20$</td>
			  <td style="font-size:large;border:1px solid black;background-color:cornflowerblue;height:40px;width:50px">$M_6$</td>
		  </tr>
	  </table>
  </td>
  </tr>
</table>

$\scriptsize Best(i,j) = \min_{k=i}^{j-1} \left( {\color{green}Best(i,k)} + {\color{magenta}Best(k+1,j)}+r_ir_{k+1}c_j \right)$<br>
$\scriptsize Best(i,i)=0$

<table class="allcenter" style="margin-top:-20px">
<tr><td style="width:50%;text-align:left;font-size:75%">
To find $Best(i,j)$: need all preceeding terms of row $i$ and column $j$

(In other words, everything below and to the left)

Conclusion: solve in order of diagonal

</td>
<td style="width:50%">
<table class="allcenter" style="font-size:90%">
<tr><td>$j=$</td><td>$1$</td><td>$2$</td><td>$3$</td><td>$4$</td><td>$5$</td><td>$6$</td><td></td><td></td></tr>
<tr><td></td><td class="border red">0</td><td class="border orange" style="font-size:small">15750</td><td class="border yellow" style="font-size:small">7875</td><td class="border green"></td><td class="border blue"></td><td class="border purple"></td><td>1</td><td></td></tr>
<tr><td></td><td></td><td class="border red">0</td><td class="border orange" style="font-size:small">2625</td><td class="border yellow"></td><td class="border green"></td><td class="border blue"></td><td>2</td><td></td></tr>
<tr><td></td><td></td><td></td><td class="border red">0</td><td class="border orange" style="font-size:small">750</td><td class="border yellow"></td><td class="border green"></td><td>3</td><td>$=i$</td></tr>
<tr><td></td><td></td><td></td><td></td><td class="border red">0</td><td class="border orange" style="font-size:small">1000</td><td class="border yellow"></td><td>4</td><td></td></tr>
<tr><td></td><td></td><td></td><td></td><td></td><td class="border red">0</td><td class="border orange" style="font-size:small">5000</td><td>5</td><td></td></tr>
<tr><td></td><td></td><td></td><td></td><td></td><td></td><td class="border red">0</td><td>6</td><td></td></tr>
</table>
</td></tr></table>


## Matrix Chaining
<table class="allcenter">
  <tr>
  <td style="padding:0">
    <table class="allcenter">
		  <tr><td></td><td style="font-size:large">$35$</td></tr>
		  <tr>
			  <td style="font-size:large">$30$</td>
			  <td style="font-size:large;border:1px solid black;background-color:yellow;height:60px;width:70px">$M_1$</td>
		  </tr>
	  </table>
  </td>
  <td style="padding:0">&nbsp;$\times$</td>
  <td style="padding:0">
    <table class="allcenter">
		  <tr><td></td><td style="font-size:large">$15$</td></tr>
		  <tr>
			  <td style="font-size:large">$35$</td>
			  <td style="font-size:large;border:1px solid black;background-color:yellow;height:70px;width:30px">$M_2$</td>
		  </tr>
	  </table>
  </td>
  <td style="padding:0">&nbsp;$\times$</td>
  <td style="padding:0">
    <table class="allcenter">
		  <tr><td></td><td style="font-size:large">$5$</td></tr>
		  <tr>
			  <td style="font-size:large">$15$</td>
			  <td style="font-size:large;border:1px solid black;background-color:yellow;height:30px;width:10px">$M_3$</td>
		  </tr>
	  </table>
  </td>
  <td style="padding:0">&nbsp;$\times$</td>
  <td style="padding:0">
    <table class="allcenter">
		  <tr><td></td><td style="font-size:large">$10$</td></tr>
		  <tr>
			  <td style="font-size:large">$5$</td>
			  <td style="font-size:large;border:1px solid black;background-color:yellow;height:10px;width:20px">$M_4$</td>
		  </tr>
	  </table>
  </td>
  <td style="padding:0">&nbsp;$\times$</td>
  <td style="padding:0">
    <table class="allcenter">
		  <tr><td></td><td style="font-size:large">$20$</td></tr>
		  <tr>
			  <td style="font-size:large">$10$</td>
			  <td style="font-size:large;border:1px solid black;background-color:yellow;height:20px;width:40px">$M_5$</td>
		  </tr>
	  </table>
  </td>
  <td style="padding:0">&nbsp;$\times$</td>
  <td style="padding:0">
    <table class="allcenter">
		  <tr><td></td><td style="font-size:large">$25$</td></tr>
		  <tr>
			  <td style="font-size:large">$20$</td>
			  <td style="font-size:large;border:1px solid black;background-color:yellow;height:40px;width:50px">$M_6$</td>
		  </tr>
	  </table>
  </td>
  </tr>
</table>

$\scriptsize Best(i,j) = \min_{k=i}^{j-1} \left( {\color{green}Best(i,k)} + {\color{magenta}Best(k+1,j)}+r_ir_{k+1}c_j \right)$<br>
$\scriptsize Best(i,i)=0$

<table class="allcenter" style="margin-top:-20px">
<tr><td style="width:50%;text-align:center;font-size:75%">
::: {.fragment}
$\small Best(1,6) = \min$<br>&nbsp;<br>
$\small \begin{cases}
{\color{green}Best(1,1)} + {\color{magenta}Best(2,6)} + r_1r_2c_6 \\
{\color{green}Best(1,2)} + {\color{magenta}Best(3,6)} + r_1r_3c_6 \\
{\color{green}Best(1,3)} + {\color{magenta}Best(4,6)} + r_1r_4c_6 \\
{\color{green}Best(1,4)} + {\color{magenta}Best(5,6)} + r_1r_5c_6 \\
{\color{green}Best(1,5)} + {\color{magenta}Best(6,6)} + r_1r_6c_6 \\
\end{cases}$
:::
</td>
<td style="width:50%">
<table class="allcenter" style="font-size:90%">
<tr><td>$j=$</td><td>$1$</td><td>$2$</td><td>$3$</td><td>$4$</td><td>$5$</td><td>$6$</td><td></td><td></td></tr>
<tr><td></td><td class="border">0</td><td class="border" style="font-size:small">15750</td><td class="border" style="font-size:small">7875</td><td class="border" style="font-size:small">9375</td><td class="border" style="font-size:small">11875</td><td class="border yellow" style="font-size:small">
::: {.fragment}
15125
:::
</td><td>1</td><td></td></tr>
<tr><td></td><td></td><td class="border">0</td><td class="border" style="font-size:small">2625</td><td class="border" style="font-size:small">4375</td><td class="border" style="font-size:small">7125</td><td class="border" style="font-size:small">10500</td><td>2</td><td></td></tr>
<tr><td></td><td></td><td></td><td class="border">0</td><td class="border" style="font-size:small">750</td><td class="border" style="font-size:small">2500</td><td class="border" style="font-size:small">5375</td><td>3</td><td>$=i$</td></tr>
<tr><td></td><td></td><td></td><td></td><td class="border">0</td><td class="border" style="font-size:small">1000</td><td class="border" style="font-size:small">3500</td><td>4</td><td></td></tr>
<tr><td></td><td></td><td></td><td></td><td></td><td class="border">0</td><td class="border" style="font-size:small">5000</td><td>5</td><td></td></tr>
<tr><td></td><td></td><td></td><td></td><td></td><td></td><td class="border">0</td><td>6</td><td></td></tr>
</table>
</td></tr></table>




## Run Time

<table><tr><td style="vertical-align:top;width:67%">

1. Initialize $Best[i,i]$ to be all 0s
2. Starting at each main diagonal, working to the upper-right, fill in each cell using:

::: {.no-bullets style="margin-top:-20px;margin-bottom:0"}
   - $\small Best[i,i]=0$
   - $\small \begin{align} Best[i,j] = \min_{k=i}^{j-1} ( & {\color{green}Best(i,k)} + \\  & {\color{magenta}Best(k+1,j)} + \\ & r_ir_{k+1}c_j ) \end{align}$
:::

</td><td style="vertical-align:top;width:33%">

::: {.fragment fragment-index=2}
<span class='red'>$\Theta(n^2)$ cells in the array</span>
:::

&nbsp;

::: {.fragment fragment-index=3}
<span class='red'>$\Theta(n)$ options for each cell</span>
:::

&nbsp;

::: {.fragment fragment-index=4}
<span class='red'>($n$ is the number of matrices)</span>
:::


</td></tr><tr><td>

::: {.fragment fragment-index=1}
<table class="purplenote"><tr><td style="font-size:80%">Each "call" to $Best(i,j)$ is an<br>$O(1)$ memory lookup</td></tr></table>
:::

</td><td>

::: {.fragment fragment-index=5}
<span class='red'>$\Theta(n^3)$ overall run time</span>
:::

</td></tr></table>



## Backtrack to find the best order

"Remember" which choice of $k$ was the minimum at each cell

&nbsp;

$\scriptsize Best(i,j) = \min_{k=i}^{j-1} \left( {\color{green}Best(i,k)} + {\color{magenta}Best(k+1,j)}+r_ir_{k+1}c_j \right)$<br>
$\scriptsize Best(i,i)=0$

<table class="allcenter">
<tr><td style="width:50%;text-align:center;font-size:75%">
$\small Best(1,6) = \min$<br>&nbsp;<br>
$\small \begin{cases}
{\color{green}Best(1,1)} + {\color{magenta}Best(2,6)} + r_1r_2c_6 \\
{\color{green}Best(1,2)} + {\color{magenta}Best(3,6)} + r_1r_3c_6 \\
{\color{red}Best(1,3) + Best(4,6) + r_1r_4c_6} \\
{\color{green}Best(1,4)} + {\color{magenta}Best(5,6)} + r_1r_5c_6 \\
{\color{green}Best(1,5)} + {\color{magenta}Best(6,6)} + r_1r_6c_6 \\
\end{cases}$
</td>
<td style="width:50%">
<table class="allcenter" style="font-size:90%">
<tr><td>$j=$</td><td>$1$</td><td>$2$</td><td>$3$</td><td>$4$</td><td>$5$</td><td>$6$</td><td></td><td></td></tr>
<tr><td></td><td class="border">0</td><td class="border" style="font-size:small">15750</td><td class="border" style="font-size:small">7875<br><span class='red'>1</span></td><td class="border" style="font-size:small">9375</td><td class="border" style="font-size:small">11875</td><td class="border yellow" style="font-size:small">15125<br><span class='red'>3</span></td><td>1</td><td></td></tr>
<tr><td></td><td></td><td class="border">0</td><td class="border" style="font-size:small">2625</td><td class="border" style="font-size:small">4375</td><td class="border" style="font-size:small">7125</td><td class="border" style="font-size:small">10500</td><td>2</td><td></td></tr>
<tr><td></td><td></td><td></td><td class="border">0</td><td class="border" style="font-size:small">750</td><td class="border" style="font-size:small">2500</td><td class="border" style="font-size:small">5375</td><td>3</td><td>$=i$</td></tr>
<tr><td></td><td></td><td></td><td></td><td class="border">0</td><td class="border" style="font-size:small">1000</td><td class="border" style="font-size:small">3500<br><span class='red'>5</span></td><td>4</td><td></td></tr>
<tr><td></td><td></td><td></td><td></td><td></td><td class="border">0</td><td class="border" style="font-size:small">5000</td><td>5</td><td></td></tr>
<tr><td></td><td></td><td></td><td></td><td></td><td></td><td class="border">0</td><td>6</td><td></td></tr>
</table>
</td></tr></table>


## Matrix Chaining


<table class="allcenter" style="margin-top:-20px">
  <tr>
  <td style="padding:0"><span style="font-size:3em;padding:0;margin:0">(</span></td>
  <td style="padding:0">
    <table class="allcenter">
		  <tr><td></td><td style="font-size:large">$35$</td></tr>
		  <tr>
			  <td style="font-size:large">$30$</td>
			  <td style="font-size:large;border:1px solid black;background-color:yellow;height:60px;width:70px">$M_1$</td>
		  </tr>
	  </table>
  </td>
  <td style="padding:0">&nbsp;$\times$</td>
  <td style="padding:0"><span style="font-size:2.25em;padding:0;margin:0">(</span></td>
  <td style="padding:0">
    <table class="allcenter">
		  <tr><td></td><td style="font-size:large">$15$</td></tr>
		  <tr>
			  <td style="font-size:large">$35$</td>
			  <td style="font-size:large;border:1px solid black;background-color:yellow;height:70px;width:30px">$M_2$</td>
		  </tr>
	  </table>
  </td>
  <td style="padding:0">&nbsp;$\times$</td>
  <td style="padding:0">
    <table class="allcenter">
		  <tr><td></td><td style="font-size:large">$5$</td></tr>
		  <tr>
			  <td style="font-size:large">$15$</td>
			  <td style="font-size:large;border:1px solid black;background-color:yellow;height:30px;width:10px">$M_3$</td>
		  </tr>
	  </table>
  </td>
  <td style="padding:0"><span style="font-size:2.25em;padding:0;margin:0">)</span></td>
  <td style="padding:0"><span style="font-size:3em;padding:0;margin:0">)</span></td>
  <td style="padding:0">$\times$</td>
  <td style="padding:0"><span style="font-size:3em;padding:0;margin:0">(</span></td>
  <td style="padding:0"><span style="font-size:2.25em;padding:0;margin:0">(</span></td>
  <td style="padding:0">
    <table class="allcenter">
		  <tr><td></td><td style="font-size:large">$10$</td></tr>
		  <tr>
			  <td style="font-size:large">$5$</td>
			  <td style="font-size:large;border:1px solid black;background-color:yellow;height:10px;width:20px">$M_4$</td>
		  </tr>
	  </table>
  </td>
  <td style="padding:0">&nbsp;$\times$</td>
  <td style="padding:0">
    <table class="allcenter">
		  <tr><td></td><td style="font-size:large">$20$</td></tr>
		  <tr>
			  <td style="font-size:large">$10$</td>
			  <td style="font-size:large;border:1px solid black;background-color:yellow;height:20px;width:40px">$M_5$</td>
		  </tr>
	  </table>
  </td>
  <td style="padding:0"><span style="font-size:2.25em;padding:0;margin:0">)</span></td>
  <td style="padding:0">$\times$</td>
  <td style="padding:0">
    <table class="allcenter">
		  <tr><td></td><td style="font-size:large">$25$</td></tr>
		  <tr>
			  <td style="font-size:large">$20$</td>
			  <td style="font-size:large;border:1px solid black;background-color:yellow;height:40px;width:50px">$M_6$</td>
		  </tr>
	  </table>
  </td>
  <td style="padding:0"><span style="font-size:3em;padding:0;margin:0">)</span></td>
  </tr>
</table>

$\scriptsize Best(i,j) = \min_{k=i}^{j-1} \left( {\color{green}Best(i,k)} + {\color{magenta}Best(k+1,j)}+r_ir_{k+1}c_j \right)$<br>
$\scriptsize Best(i,i)=0$

<table class="allcenter">
<tr><td style="width:50%;text-align:center;font-size:75%">
$\small Best(1,6) = \min$<br>&nbsp;<br>
$\small \begin{cases}
{\color{green}Best(1,1)} + {\color{magenta}Best(2,6)} + r_1r_2c_6 \\
{\color{green}Best(1,2)} + {\color{magenta}Best(3,6)} + r_1r_3c_6 \\
{\color{green}Best(1,3)} + {\color{magenta}Best(4,6)} + r_1r_4c_6 \\
{\color{green}Best(1,4)} + {\color{magenta}Best(5,6)} + r_1r_5c_6 \\
{\color{green}Best(1,5)} + {\color{magenta}Best(6,6)} + r_1r_6c_6 \\
\end{cases}$
</td>
<td style="width:50%">
<table class="allcenter" style="font-size:90%">
<tr><td>$j=$</td><td>$1$</td><td>$2$</td><td>$3$</td><td>$4$</td><td>$5$</td><td>$6$</td><td></td><td></td></tr>
<tr><td></td><td class="border">0</td><td class="border" style="font-size:small">15750</td><td class="border" style="font-size:small">7875<br><span class='red'>1</span></td><td class="border" style="font-size:small">9375</td><td class="border" style="font-size:small">11875</td><td class="border yellow" style="font-size:small">15125<br><span class='red'>3</span></td><td>1</td><td></td></tr>
<tr><td></td><td></td><td class="border">0</td><td class="border" style="font-size:small">2625</td><td class="border" style="font-size:small">4375</td><td class="border" style="font-size:small">7125</td><td class="border" style="font-size:small">10500</td><td>2</td><td></td></tr>
<tr><td></td><td></td><td></td><td class="border">0</td><td class="border" style="font-size:small">750</td><td class="border" style="font-size:small">2500</td><td class="border" style="font-size:small">5375</td><td>3</td><td>$=i$</td></tr>
<tr><td></td><td></td><td></td><td></td><td class="border">0</td><td class="border" style="font-size:small">1000</td><td class="border" style="font-size:small">3500<br><span class='red'>5</span></td><td>4</td><td></td></tr>
<tr><td></td><td></td><td></td><td></td><td></td><td class="border">0</td><td class="border" style="font-size:small">5000</td><td>5</td><td></td></tr>
<tr><td></td><td></td><td></td><td></td><td></td><td></td><td class="border">0</td><td>6</td><td></td></tr>
</table>
</td></tr></table>




## [Storing and Recovering Optimal Solution]{.r-fit-text}

- Maintain table <span class='blue'>choice[i,j]</span> in addition to <span class='blue'>Best</span> table
	- <span class='blue'>choice[i,j] = k</span> means the best "split" was right after <span class='magenta'>$M_k$</span>
	- Work backwards from value for whole problem, <span class='blue'>choice[1,n]</span>
	- Note: <span class='blue'>choice[i,i+1] = i</span> because there are just 2 matrices 
- From our example:
	- <span class='blue'>choice[1,6] = 3</span>.   So <span class='magenta'>$[M_1 \times M_2 \times M_3] \times [M_4 \times M_5 \times M_6]$</span>
	- We then need <span class='blue'>choice[1,3] = 1.   So <span class='magenta'>$[M_1 \times (M_2 \times M_3)]$</span>
	- Also need <span class='blue'>choice[4,6] = 5</span>.  So <span class='magenta'>$[(M_4 \times M_5) \times M_6]$</span>
	- Overall: <span class='magenta'>$[M_1 \times (M_2 \times M_3)] \times [(M_4 \times M_5) \times M_6]$</span>


## Dynamic Programming

- Requires <span class="magenta">Optimal Substructure</span>
	- Solution to larger problem contains the (optimal) solutions to smaller ones
- Idea:
	1. Identify recursive structure of the problem
		- What is the "last thing" done?
	2. Save the solution to each subproblem in memory
	3. Select a good order for solving subproblems
		- "Top Down": Solve each recursively
		- "Bottom Up": Iteratively solve smallest to largest



# Making Change <!-- from day18.pptx -->

::: {.titlereading}
Readings in CLRS 4th edition: chapter 14
:::



## Warm-Up

**Remember change making?**

Given access to unlimited quantities of pennies, nickels, dimes, toms, and quarters (worth value 1, 5, 10, 11, 25 respectively), give 90 cents change using the **fewest** number of coins.

<table class="allcenter compact"><tr><td>

![](https://upload.wikimedia.org/wikipedia/commons/e/e2/United_States_penny%2C_obverse%2C_2002.jpg){style="height:114px"} 
![](https://upload.wikimedia.org/wikipedia/commons/f/f9/United_States_penny%2C_reverse.jpg){style="height:114px"} 
![](https://upload.wikimedia.org/wikipedia/commons/thumb/7/72/Jefferson-Nickel-Unc-Obv.jpg/780px-Jefferson-Nickel-Unc-Obv.jpg){style="height:132px"} 
![](https://upload.wikimedia.org/wikipedia/commons/2/23/US_Nickel_Reverse.jpg){style="height:132px"}

![](https://upload.wikimedia.org/wikipedia/commons/8/84/2005-Dime-Obv-Unc-P.png){style="height:107px"} 
![](https://upload.wikimedia.org/wikipedia/commons/thumb/1/10/2005-Dime-unc-GS_%28reverse%29.png/775px-2005-Dime-unc-GS_%28reverse%29.png){style="height:107px"}
![](https://upload.wikimedia.org/wikipedia/commons/thumb/5/5d/United_States_quarter%2C_obverse%2C_2004.jpg/776px-United_States_quarter%2C_obverse%2C_2004.jpg){style="height:146px"} 
![](https://upload.wikimedia.org/wikipedia/commons/thumb/e/e2/Virginia_quarter%2C_reverse_side%2C_2000.jpg/769px-Virginia_quarter%2C_reverse_side%2C_2000.jpg){style="height:146px"} 

</td><td>

::: {.r-stack}
![](https://upload.wikimedia.org/wikipedia/commons/thumb/6/64/Thomas_Jefferson_Presidential_%241_Coin_obverse.png/1024px-Thomas_Jefferson_Presidential_%241_Coin_obverse.png){style="height:200px;z-index:0"}
<table style="z-index:1">
<tr>
<td style="text-align:right;width:160px;font-size:small">
11&nbsp;&nbsp;<br>cents
</td></tr></table>
:::

</td></tr></table>


## [Remember: Greedy Change Making Algorithm]{.r-fit-text}

<div style="font-size:90%">

- Given: target value $x$, list of coins $C=[c_1, \ldots, c_n]$
	- For the US, $C=[1,5,10,25]$
- Repeatedly select the largest coin less than the remaining target value

&nbsp;

::: {.no-bullets}
- while ( x > 0 )
  - let $c = \max(c_i \in C | c_i \le x)$
  - print $c$
  - $x=x-c$
:::

**Observation:** We can rewrite this to take $\lfloor n/c \rfloor$ copies of the next largest coin at each step, and reduce $x$ by $c \cdot \lfloor n/c \rfloor$.  Also avoid call to max() by choosing next $c_i$ from largest to smallest (sort $C$ first).

</div>


## Greedy Solution

90 cents

<table><tr><td>
::: {.fragment}
![](https://upload.wikimedia.org/wikipedia/commons/thumb/5/5d/United_States_quarter%2C_obverse%2C_2004.jpg/776px-United_States_quarter%2C_obverse%2C_2004.jpg){style="height:219px"} 
![](https://upload.wikimedia.org/wikipedia/commons/thumb/5/5d/United_States_quarter%2C_obverse%2C_2004.jpg/776px-United_States_quarter%2C_obverse%2C_2004.jpg){style="height:219px"} 
![](https://upload.wikimedia.org/wikipedia/commons/thumb/5/5d/United_States_quarter%2C_obverse%2C_2004.jpg/776px-United_States_quarter%2C_obverse%2C_2004.jpg){style="height:219px"} 
:::
</td><td>
::: {.fragment}
::: {.r-stack}
![](https://upload.wikimedia.org/wikipedia/commons/thumb/6/64/Thomas_Jefferson_Presidential_%241_Coin_obverse.png/1024px-Thomas_Jefferson_Presidential_%241_Coin_obverse.png){style="height:225px;z-index:0"}
<table style="z-index:1">
<tr>
<td style="text-align:right;width:185px;font-size:large">
11&nbsp;&nbsp;<br>cents
</td></tr></table>
:::
:::
</td></tr>
<tr><td colspan='2'>
::: {.fragment}
![](https://upload.wikimedia.org/wikipedia/commons/e/e2/United_States_penny%2C_obverse%2C_2002.jpg){style="height:171px"} 
![](https://upload.wikimedia.org/wikipedia/commons/e/e2/United_States_penny%2C_obverse%2C_2002.jpg){style="height:171px"} 
![](https://upload.wikimedia.org/wikipedia/commons/e/e2/United_States_penny%2C_obverse%2C_2002.jpg){style="height:171px"} 
![](https://upload.wikimedia.org/wikipedia/commons/e/e2/United_States_penny%2C_obverse%2C_2002.jpg){style="height:171px"} 
:::
</td></tr></table>


## Correct Solution

90 cents

::: {.fragment}
![](https://upload.wikimedia.org/wikipedia/commons/thumb/5/5d/United_States_quarter%2C_obverse%2C_2004.jpg/776px-United_States_quarter%2C_obverse%2C_2004.jpg){style="height:219px"} 
![](https://upload.wikimedia.org/wikipedia/commons/thumb/5/5d/United_States_quarter%2C_obverse%2C_2004.jpg/776px-United_States_quarter%2C_obverse%2C_2004.jpg){style="height:219px"} 
![](https://upload.wikimedia.org/wikipedia/commons/thumb/5/5d/United_States_quarter%2C_obverse%2C_2004.jpg/776px-United_States_quarter%2C_obverse%2C_2004.jpg){style="height:219px"} 
![](https://upload.wikimedia.org/wikipedia/commons/8/84/2005-Dime-Obv-Unc-P.png){style="height:171px"} 
![](https://upload.wikimedia.org/wikipedia/commons/thumb/7/72/Jefferson-Nickel-Unc-Obv.jpg/780px-Jefferson-Nickel-Unc-Obv.jpg){style="height:198px"} 
:::

## [Why does greedy always work for US coins?]{.r-fit-text}


- If $x<5$, then pennies only
  - Else 5 pennies can be exchanged for a nickel
  - <span class='red'>Only case where Greedy uses pennies</span>
- If $x \le 5 < 10$, we must have a nickel
  - Else 2 nickels can be exchanged for a dime
  - <span class='red'>Only case where Greedy uses nickels</span>
- If $10 \le x < 25$, we must have at least 1 dime
  - Else 3 dimes can be exchanged for a quarter and a nickel
  - <span class='red'>Only case where Greedy uses dimes</span>
- If $x \ge 25$, we must have at least 1 quarter
  - <span class='red'>Only case where Greedy uses quarters</span>

## Dynamic Programming

- Requires <span class="magenta">Optimal Substructure</span>
	- Solution to larger problem contains the (optimal) solutions to smaller ones
- Idea:
<ol>
	<li class="purple">Identify recursive structure of the problem
    	<ul><li>What is the "last thing" done?</li></ul></li>
	<li>Save the solution to each subproblem in memory</li>
	<li>Select a good order for solving subproblems
		<ul>
			<li>"Top Down": Solve each recursively</li>
			<li>"Bottom Up": Iteratively solve smallest to largest</li>
		</ul></li>
</ol>


## [1. Identify the Recursive Structure of the Problem]{.r-fit-text}

<span style="font-size:80%;text-align:center">$Change(n)$: minimum number of coins needed to give change for $n$ cents</span>

::: {.allcenter .compact style="font-size:75%"}
| Possibilities<br>for last coin | Coins needed | When to do |
|----|----|----|
| ![](https://upload.wikimedia.org/wikipedia/commons/thumb/5/5d/United_States_quarter%2C_obverse%2C_2004.jpg/776px-United_States_quarter%2C_obverse%2C_2004.jpg){style="height:73px"} | $Change(n-25)+1$ | if $n \ge 25$
|  ![](https://upload.wikimedia.org/wikipedia/commons/thumb/6/64/Thomas_Jefferson_Presidential_%241_Coin_obverse.png/1024px-Thomas_Jefferson_Presidential_%241_Coin_obverse.png){style="height:75px;z-index:0"} | $Change(n-11)+1$ | if $n \ge 11$ |
| ![](https://upload.wikimedia.org/wikipedia/commons/8/84/2005-Dime-Obv-Unc-P.png){style="height:57px"}  | $Change(n-10)+1$ | if $n \ge 10$ |
| ![](https://upload.wikimedia.org/wikipedia/commons/thumb/7/72/Jefferson-Nickel-Unc-Obv.jpg/780px-Jefferson-Nickel-Unc-Obv.jpg){style="height:66px"} | $Change(n-5)+1$ | if $n \ge 5$ |
| ![](https://upload.wikimedia.org/wikipedia/commons/e/e2/United_States_penny%2C_obverse%2C_2002.jpg){style="height:57px"} | $Change(n-1)+1$ | if $n \ge 1$ |
:::


## [1. Identify the Recursive Structure of the Problem]{.r-fit-text}

<span style="font-size:80%;text-align:center">$Change(n)$: minimum number of coins needed to give change for cents</span>

<table><tr><td style="font-size:75%">
::: {.fragment fragment-index=1}
$$Change(n) = \min
\begin{cases}
Change(n-25)+1 \text{ if } n \ge 25 \\
Change(n-11)+1 \text{ if } n \ge 11 \\
Change(n-10)+1 \text{ if } n \ge 10 \\
Change(n-5)+1 \text{ if } n \ge 5 \\
Change(n-1)+1 \text{ if } n \ge 1 \\
\end{cases}$$
:::
</td><td style="vertical-align:top">
::: {.fragment fragment-index=2}
<table class="bluenote"><tr><td style="font-size:75%"><b>Correctness:</b> The optimal solution must be contained in one of these configurations</td></tr></table>
:::
</td></tr></table>

<table style="font-size:80%"><tr><td>
::: {.fragment fragment-index=3}
<span>**Base Case:** $Change(0)=0$</span>
:::
</td><td></td><td></td></tr>

<tr><td>
::: {.fragment fragment-index=4}
**Running time:** $O(k \cdot n)$
:::
</td><td>
::: {.fragment fragment-index=5}
Is this&nbsp;<span style="text-decoration:underline">efficient</span>?
:::
</td>
<td>
::: {.fragment fragment-index=6}
<table class="purplenote"><tr><td>Input size is $O(k \log n)$</td></tr></table>
:::
</td>
</tr>

<tr><td>
::: {.fragment fragment-index=4}
$k$ is the number of coins
:::
</td><td colspan='2'>
::: {.fragment fragment-index=6}
No, this is <span style="text-decoration:underline">pseudo-polynomial</span> time
:::
</td></tr>

</table>



# Seam Carving <!-- from day18.pptx -->

::: {.titlereading}
Readings in CLRS 4th edition: chapter 14
:::



## Seam Carving

Method for image resizing that doesnt scale/crop the image

::: {.fragment}
![](images/dp/ducks-small.webp){.center .stretch}
:::

## Cropping
Removes a "block" of pixels

<table class='center allcenter'>
<tr><td>

<table class="compact"><tr><td>
![](images/dp/ducks-small.webp){.ducks-left}
</td><td>

::: {.r-stack}
![](images/dp/ducks-small.webp){.ducks-right}

::: {.fragment fragment-index=1 .fade-in}
![](images/spacer.png){.ducks-right-red-box}
:::
:::

</td></tr></table></td>
<td>
::: {.fragment fragment-index=2}
&rarr;
:::
</td><td>
::: {.fragment fragment-index=2}
![](images/dp/ducks-small.webp){.ducks-left}
:::
</td></tr></table>


## Scaling
Removes "stripes" of pixels

<table class='center allcenter'>
<tr><td>

::: {.r-stack}
![](images/dp/ducks-small.webp){.ducks-normal}

::: {.fragment fragment-index=1}
<table class="compact center allcenter"><tr>
<td>![](images/spacer.png){.ducks-crop-bars}</td>
<td>![](images/spacer.png){.ducks-crop-bars}</td>
<td>![](images/spacer.png){.ducks-crop-bars}</td>
<td>![](images/spacer.png){.ducks-crop-bars}</td>
<td>![](images/spacer.png){.ducks-crop-bars}</td>
<td>![](images/spacer.png){.ducks-crop-bars}</td>
<td>![](images/spacer.png){.ducks-crop-bars}</td>
<td>![](images/spacer.png){.ducks-crop-bars}</td>
<td>![](images/spacer.png){.ducks-crop-bars}</td>
<td>![](images/spacer.png){.ducks-crop-bars}</td>
<td>![](images/spacer.png){.ducks-crop-bars}</td>
<td>![](images/spacer.png){.ducks-crop-bars}</td>
<td>![](images/spacer.png){.ducks-crop-bars}</td>
<td>![](images/spacer.png){.ducks-crop-bars}</td>
<td>![](images/spacer.png){.ducks-crop-bars}</td>
<td>![](images/spacer.png){.ducks-crop-bars}</td>
<td>![](images/spacer.png){.ducks-crop-bars}</td>
<td>![](images/spacer.png){.ducks-crop-bars}</td>
<td>![](images/spacer.png){.ducks-crop-bars}</td>
<td>![](images/spacer.png){.ducks-crop-bars}</td>
<td>![](images/spacer.png){.ducks-crop-bars}</td>
<td>![](images/spacer.png){.ducks-crop-bars}</td>
<td>![](images/spacer.png){.ducks-crop-bars}</td>
<td>![](images/spacer.png){.ducks-crop-bars}</td>
</tr></table>
:::
:::

</td><td>
::: {.fragment fragment-index=2}
&rarr;
:::
</td><td>
::: {.fragment fragment-index=2}
![](images/dp/ducks-small.webp){.ducks-scaled}
:::
</td></tr></table>

::: {.fragment fragment-index=3}
(There are more visually pleasing ways to scale images)
:::

## Seam Carving

Removes "least energy seam" of pixels

[https://trekhleb.dev/js-image-carver/](https://trekhleb.dev/js-image-carver/) 


<table class='center allcenter'>
<tr><td>

::: {.r-stack}
![](images/dp/ducks-small.webp){.ducks-normal}

::: {.fragment fragment-index=1}
![](images/dp/ducks-seams.svg){.ducks-normal}
:::
:::

</td><td>
::: {.fragment fragment-index=2}
&rarr;
:::
</td><td>
::: {.fragment fragment-index=2}
![](images/dp/ducks-carved.webp){style="height:384px"}
:::
</td></tr></table>


## Seam Carving

Method for image resizing that doesnt scale/crop the image

::: {.allcenter}
| Cropped | Scaled | Carved |
|----|----|----|
| ![](images/dp/ducks-small.webp){.ducks-left} | ![](images/dp/ducks-small.webp){.ducks-scaled} | ![](images/dp/ducks-carved.webp){style="height:384px"} |
:::

## Seattle Skyline

![](https://upload.wikimedia.org/wikipedia/commons/thumb/9/9b/Seattle_Skyline_-_2008.jpg/1280px-Seattle_Skyline_-_2008.jpg){.center style="width:50%"}

::: {.fragment}
[![](https://upload.wikimedia.org/wikipedia/commons/6/62/Seattle_skyline_from_West_Seattle_January_12%2C_2019_%28cropped%29.jpg){.center}](https://upload.wikimedia.org/wikipedia/commons/6/62/Seattle_skyline_from_West_Seattle_January_12%2C_2019_%28cropped%29.jpg)
:::

## Energy of a Seam

<div style="font-size:90%">

- Sum of the energies of each pixel
  - $e(p)=$ energy of pixel $p$

&nbsp;

- Many choices for pixel energy
  - Change of gradient (how much the color of this pixel differs from its neighbors)
  - Shortest path (more color change means more distance)
  - Particular choice doesn't matter, we use it as a "black box"

&nbsp;

- Restriction: seam pixels go up or diagonally up, not to the side
- Goal: find least-energy seam to remove
</div>


## Dynamic Programming

- Requires <span class="magenta">Optimal Substructure</span>
	- Solution to larger problem contains the (optimal) solutions to smaller ones
- Idea:
<ol>
	<li class="purple">Identify recursive structure of the problem
    	<ul><li>What is the "last thing" done?</li></ul></li>
	<li>Save the solution to each subproblem in memory</li>
	<li>Select a good order for solving subproblems
		<ul>
			<li>"Top Down": Solve each recursively</li>
			<li>"Bottom Up": Iteratively solve smallest to largest</li>
		</ul></li>
</ol>

## [1. Identify the Recursive Structure of the Problem]{.r-fit-text}

<table style="compact"><tr><td style="height:150px">
Let ${\color{red}S(i,j)}=$ least energy seam from the bottom of the image up to pixel $p_{i,j}$
</td></tr></table>
<table class="compact allcenter"><tr><td style="width:150px">
<span style="display:none;">formula</span>
</td><td style="width:20px">
<span style="display:none;">
![](images/underbrace-red.svg){style="transform:rotate(90deg)scale(21,6);z-index:2"}
</span>
</td><td>
::: {.r-stack}
![](images/dp/seam-grid-1.svg){style="width:800px;margin-bottom:0"}

<p style="margin-left:470px;margin-top:50px">$p_{i,j}$<br>
![](images/dp/seam-1.svg){style="transform:scale(1,1.3);margin-top:50px;margin-left:0px"}
</p>

<p style="display:none;margin-left:280px;margin-top:-40px">$p_{n,k}$<br>
![](images/dp/seam-2.svg){style="transform:scale(2.5,2.7);margin-top:115px;margin-left:-110px"}
</p>

<table style="display:none;border:3px solid orange;margin-top:-35px;margin-left:255px"><tr><td style="width:140px;height:130px">&nbsp;</td></tr></table>

:::
</td></tr>
<tr><td></td><td></td><td><span style="display:none;">![](images/underbrace-red.svg){style="transform:scale(4,1);margin-left:-20px"}<br><p style="margin-top:-30px">$m$</p></span></td></tr>
</table>



## Computing $\color{pink}S(n,k)$

<table style="compact"><tr><td style="height:150px">
Assume we know the least energy seams for all of row $n-1$ (i.e., we know $S(n-1,\ell)$ for all $\ell$)
</td></tr></table>

<table class="compact allcenter"><tr><td style="width:150px">
<span style="">Known<br>through<br>$n-1$</span>
</td><td style="width:20px;padding-top:80px">
<span style="">
![](images/underbrace-red.svg){style="transform:rotate(90deg)scale(19,6);z-index:2"}
</span>
</td><td>
::: {.r-stack}
![](images/dp/seam-grid-1.svg){style="width:800px;margin-bottom:0"}

<p style="display:none;margin-left:470px;margin-top:50px">$p_{i,j}$<br>
![](images/dp/seam-1.svg){style="transform:scale(1,1.3);margin-top:50px;margin-left:0px"}
</p>

<p style="margin-left:280px;margin-top:-40px">$p_{n,k}$<br>
![](images/dp/seam-2.svg){style="transform:scale(2.5,2.7);margin-top:115px;margin-left:-110px"}
</p>

::: {.fragment}
<table style="border:3px solid orange;margin-top:-235px;margin-left:-147px"><tr><td style="width:140px;height:130px">&nbsp;</td></tr></table>
:::

:::
</td></tr>
<tr><td></td><td></td><td><span style="">![](images/underbrace-red.svg){style="transform:scale(4,1);margin-left:-20px"}<br><p style="margin-top:-30px">$m$</p></span></td></tr>
</table>


## Computing $\color{pink}S(n,k)$

<div style="font-size:90%">

Assume we know the least energy seams for all of row $n-1$ (i.e., we know $S(n-1,\ell)$ for all $\ell$)

<table class='allcenter compact table-of-boxes'>
<tr><td></td><td>$p_{n,k}$</td><td></td></tr>
<tr><td>
<table><tr><td style="background-color:grey"></td></tr></table>
</td><td>
<table><tr><td style="background-color:red">$\color{white}S(n,k)$</td></tr></table>
</td><td>
<table><tr><td style="background-color:grey"></td></tr></table>
</td></tr><tr><td>
<table><tr><td style="background-color:blue">$\color{white}S(n-1,k-1)$</td></tr></table>
</td><td>
<table><tr><td style="background-color:purple">$\color{white}S(n-1,k)$</td></tr></table>
</td><td>
<table><tr><td style="background-color:magenta">$\color{white}S(n-1,k+1)$</td></tr></table>
</td></tr></table>

::: {.fragment}
$${\color{red}S(n,k)} = \min
\begin{cases}
{\color{blue}S(n-1,k-1)} & + e(p_{n,k}) \\
{\color{purple}S(n-1,k)} & + e(p_{n,k}) \\
{\color{magenta}S(n-1,k+1)} & + e(p_{n,k}) \\
\end{cases}$$
:::

</div>



## Finding the Least Energy Seam

<table style="compact"><tr><td style="height:150px">
Want to delete the least energy seam going from bottom to top, so delete: $\min_{k=1}^m({\color{red}S(n,k)})$
</td></tr></table>
<table class="compact allcenter"><tr><td style="width:150px">
<span style="">$n$</span>
</td><td style="width:20px">
<span style="">
![](images/underbrace-red.svg){style="transform:rotate(90deg)scale(21,6);z-index:2"}
</span>
</td><td>
::: {.r-stack}
![](images/dp/seam-grid-1.svg){style="width:800px;margin-bottom:0"}

<p style="display:none;margin-left:470px;margin-top:50px">$p_{i,j}$<br>
![](images/dp/seam-1.svg){style="transform:scale(1,1.3);margin-top:50px;margin-left:0px"}
</p>

<p style="margin-left:280px;margin-top:-40px">$p_{n,k}$<br>
![](images/dp/seam-2.svg){style="transform:scale(2.5,2.7);margin-top:115px;margin-left:-110px"}
</p>

<table style="display:none;border:3px solid orange;margin-top:-35px;margin-left:255px"><tr><td style="width:140px;height:130px">&nbsp;</td></tr></table>

:::
</td></tr>
<tr><td></td><td></td><td><span style="">![](images/underbrace-red.svg){style="transform:scale(4,1);margin-left:-20px"}<br><p style="margin-top:-30px">$m$</p></span></td></tr>
</table>



## Dynamic Programming

- Requires <span class="magenta">Optimal Substructure</span>
	- Solution to larger problem contains the (optimal) solutions to smaller ones
- Idea:
<ol>
	<li>Identify recursive structure of the problem
    	<ul><li>What is the "last thing" done?</li></ul></li>
	<li class="purple">Save the solution to each subproblem in memory</li>
	<li>Select a good order for solving subproblems
		<ul>
			<li>"Top Down": Solve each recursively</li>
			<li>"Bottom Up": Iteratively solve smallest to largest</li>
		</ul></li>
</ol>


## Computing $\color{pink}S(n,k)$

<div style="font-size:90%">

Assume we know the least energy seams for all of row $n-1$ (i.e., we know $S(n-1,\ell)$ for all $\ell$)

<table class='allcenter compact table-of-boxes'>
<tr><td></td><td>$p_{n,k}$</td><td></td></tr>
<tr><td>
<table><tr><td style="background-color:grey"></td></tr></table>
</td><td>
<table><tr><td style="background-color:red">$\color{white}S(n,k)$</td></tr></table>
</td><td>
<table><tr><td style="background-color:grey"></td></tr></table>
</td></tr><tr><td>
<table><tr><td style="background-color:blue">$\color{white}S(n-1,k-1)$</td></tr></table>
</td><td>
<table><tr><td style="background-color:purple">$\color{white}S(n-1,k)$</td></tr></table>
</td><td>
<table><tr><td style="background-color:magenta">$\color{white}S(n-1,k+1)$</td></tr></table>
</td></tr></table>

$${\color{red}S(n,k)} = \min
\begin{cases}
{\color{blue}S(n-1,k-1)} & + e(p_{n,k}) \\
{\color{purple}S(n-1,k)} & + e(p_{n,k}) \\
{\color{magenta}S(n-1,k+1)} & + e(p_{n,k}) \\
\end{cases}$$

</div>


## Finding the Least Energy Seam

<table style="compact"><tr><td style="height:150px">
Want to delete the least energy seam going from bottom to top, so delete: $\min_{k=1}^m({\color{red}S(n,k)})$
</td></tr></table>
<table class="compact allcenter"><tr><td style="width:150px">
<span style="">$n$</span>
</td><td style="width:20px">
<span style="">
![](images/underbrace-red.svg){style="transform:rotate(90deg)scale(21,6);z-index:2"}
</span>
</td><td>
::: {.r-stack}
![](images/dp/seam-grid-1.svg){style="width:800px;margin-bottom:0"}

<p style="display:none;margin-left:470px;margin-top:50px">$p_{i,j}$<br>
![](images/dp/seam-1.svg){style="transform:scale(1,1.3);margin-top:50px;margin-left:0px"}
</p>

<p style="margin-left:280px;margin-top:-40px">$p_{n,k}$<br>
![](images/dp/seam-2.svg){style="transform:scale(2.5,2.7);margin-top:115px;margin-left:-110px"}
</p>

<table style="display:none;border:3px solid orange;margin-top:-35px;margin-left:255px"><tr><td style="width:140px;height:130px">&nbsp;</td></tr></table>

:::
</td></tr>
<tr><td></td><td></td><td><span style="">![](images/underbrace-red.svg){style="transform:scale(4,1);margin-left:-20px"}<br><p style="margin-top:-30px">$m$</p></span></td></tr>
</table>


## Dynamic Programming

- Requires <span class="magenta">Optimal Substructure</span>
	- Solution to larger problem contains the (optimal) solutions to smaller ones
- Idea:
<ol>
	<li>Identify recursive structure of the problem
    	<ul><li>What is the "last thing" done?</li></ul></li>
	<li>Save the solution to each subproblem in memory</li>
	<li class="purple">Select a good order for solving subproblems
		<ul>
			<li>"Top Down": Solve each recursively</li>
			<li>"Bottom Up": Iteratively solve smallest to largest</li>
		</ul></li>
</ol>




## Bring It All Together
<table style="font-size:80%;text-size:80%;width:100%">
<tr style="height:70px"><td>Start from bottom of image (row 1), solve up to top</td><td style="width:170px"></td></tr>
<tr style="height:80px"><td><span class='green'>Initialize $S(1,k)=e(p_{1,k})$ for each pixel in row 1</span></td><td><span style="display:none;">$\color{green}\Theta(m)$</span></td></tr>
<tr style="height:180px"><td>
<span style="font-size:90%;display:none">For $i \ge 2$ find ${\color{red}S(n,k)} = \min
\begin{cases}
{\color{purple}S(n-1,k-1)} & + e(p_{i,k}) \\
{\color{blue}S(n-1,k)} & + e(p_{i,k}) \\
{\color{magenta}S(n-1,k+1)} & + e(p_{i,k}) \\
\end{cases}$
</span></td><td><span style="display:none;">$\color{red}\Theta(n \cdot m)$</span></td></tr>
<tr style="height:80px"><td><span style="display:none;">Pick min $\color{red}S(n,k)$ from top row, backtrack, deleting pixels</td><td><span style="display:none;">$\Theta(n+m)$</span></td></tr>
<tr style="height:300px"><td> ![](images/dp/seam-grid-2.svg) </td><td style="color:green;vertical-align:middle;font-size:75%"><span style="">Energy of the seam initialized to the energy of that pixel</span></td></tr>
</table>
</span>



## Bring It All Together
<table style="font-size:80%;text-size:80%;width:100%">
<tr style="height:70px"><td>Start from bottom of image (row 1), solve up to top</td><td style="width:170px"></td></tr>
<tr style="height:80px"><td><span class='green'>Initialize $S(1,k)=e(p_{1,k})$ for each pixel $p_{1,k}$</span></td><td><span style="display:none;">$\color{green}\Theta(m)$</span></td></tr>
<tr style="height:180px"><td>
<span style="font-size:90%">For $i \ge 2$ find ${\color{red}S(i,k)} = \min
\begin{cases}
{\color{purple}S(i-1,k-1)} & + e(p_{i,k}) \\
{\color{blue}S(i-1,k)} & + e(p_{i,k}) \\
{\color{magenta}S(i-1,k+1)} & + e(p_{i,k}) \\
\end{cases}$
</span></td><td><span style="display:none;">$\color{red}\Theta(n \cdot m)$</span></td></tr>
<tr style="height:80px"><td><span style="display:none;">Pick min $\color{red}S(n,k)$ from top row, backtrack, deleting pixels</td><td><span style="display:none;">$\Theta(n+m)$</span></td></tr>
<tr style="height:300px"><td> ![](images/dp/seam-grid-3.svg) </td><td style="color:green;vertical-align:middle;font-size:75%"><span style="">Energy of the seam initialized to the energy of that pixel</span></td></tr>
</table>
</span>



## Finding the Seam
<table style="font-size:80%;text-size:80%;width:100%">
<tr style="height:70px"><td>Start from bottom of image (row 1), solve up to top</td><td style="width:170px"></td></tr>
<tr style="height:80px"><td><span class='green'>Initialize $S(1,k)=e(p_{1,k})$ for each pixel $p_{1,k}$</span></td><td><span style="display:none;">$\color{green}\Theta(m)$</span></td></tr>
<tr style="height:180px"><td>
<span style="font-size:90%">For $i \ge 2$ find ${\color{red}S(i,k)} = \min
\begin{cases}
{\color{purple}S(i-1,k-1)} & + e(p_{i,k}) \\
{\color{blue}S(i-1,k)} & + e(p_{i,k}) \\
{\color{magenta}S(i-1,k+1)} & + e(p_{i,k}) \\
\end{cases}$
</span></td><td><span style="display:none;">$\color{red}\Theta(n \cdot m)$</span></td></tr>
<tr style="height:80px"><td><span style="">Pick min $\color{red}S(n,k)$ from top row, backtrack, deleting pixels</td><td><span style="display:none;">$\Theta(n+m)$</span></td></tr>
<tr style="height:300px"><td> ![](images/dp/seam-grid-3.svg) </td><td style="color:green;vertical-align:middle;font-size:75%"><span style="">Energy of the seam initialized to the energy of that pixel</span></td></tr>
</table>
</span>



## Run Time?
<table style="font-size:80%;text-size:80%;width:100%">
<tr style="height:70px"><td>Start from bottom of image (row 1), solve up to top</td><td style="width:170px"></td></tr>
<tr style="height:80px"><td><span class='green'>Initialize $S(1,k)=e(p_{1,k})$ for each pixel $p_{1,k}$</span></td><td>
::: {.fragment}
<span style="">$\color{green}\Theta(m)$</span>
:::
</td></tr>
<tr style="height:180px"><td>
<span style="font-size:90%">For $i \ge 2$ find ${\color{red}S(i,k)} = \min
\begin{cases}
{\color{purple}S(i-1,k-1)} & + e(p_{i,k}) \\
{\color{blue}S(i-1,k)} & + e(p_{i,k}) \\
{\color{magenta}S(i-1,k+1)} & + e(p_{i,k}) \\
\end{cases}$
</span></td><td>
::: {.fragment}
<span style="">$\color{red}\Theta(n \cdot m)$</span>
:::
</td></tr>
<tr style="height:80px"><td><span style="">Pick min $\color{red}S(n,k)$ from top row, backtrack, deleting pixels</td><td>
::: {.fragment}
<span style="">$\Theta(n+m)$</span>
:::
</td></tr>
<tr style="height:300px"><td> ![](images/dp/seam-grid-3.svg) </td><td style="color:green;vertical-align:middle;font-size:75%"><span style="">Energy of the seam initialized to the energy of that pixel</span></td></tr>
</table>
</span>



## Repeated Seam Removal
Only need to update <span class='blue'>pixels dependant</span> on the <span color='red'>removed seam</span>

<table style="width:100%">
<tr><td class='bluetext'>$2n$ pixels change</td><td>
::: {.fragment}
$\Theta(2n)$ time to update pixels
:::
</td></tr>
<tr><td></td><td>
::: {.fragment}
$\Theta(n+m)$ to find min+backtrack
:::
</td></tr>
</table>


![](images/dp/seam-grid-4.svg){.center .stretch}



# Longest Common Subsequence <!-- from day18.pptx and day19.pptx -->

::: {.titlereading}
Readings in CLRS 4th edition: chapter 14, specifically 14.4
:::



## Longest Common Subsequence

<table><tr>
<td style="width:50%">
Given two sequences $X$ and $Y$, find the length of their longest common subsequence

&nbsp;

Example:<br>
 = <span class='red'></span><span class='red'></span><br> 
 = <span class='red'></span><span class='red'></span><span class='red'></span><br>
 = <span class='red'></span>

</td><td style="vertical-align:top;width:50%"> ![](https://upload.wikimedia.org/wikipedia/commons/thumb/f/fe/DNA_simple2.svg/728px-DNA_simple2.svg.png) </td>
</tr></table>

::: {.fragment}
Brute force: compare every subsequence of $X$ with $Y$: $\Omega(2^n)$
:::

## Dynamic Programming

- Requires <span class="magenta">Optimal Substructure</span>
	- Solution to larger problem contains the (optimal) solutions to smaller ones
- Idea:
<ol>
	<li class="purple">Identify recursive structure of the problem
    	<ul><li>What is the "last thing" done?</li></ul></li>
	<li>Save the solution to each subproblem in memory</li>
	<li>Select a good order for solving subproblems
		<ul>
			<li>"Top Down": Solve each recursively</li>
			<li>"Bottom Up": Iteratively solve smallest to largest</li>
		</ul></li>
</ol>



## [1. Identify the Recursive Structure of the Problem]{.r-fit-text}

<div style="font-size:70% !important">

Let $LCS(i.j)=$ length of the LCS for the first $i$ characters of $X$, first $j$ characters of $Y$

Find $\color{magenta}LCS(i,j)$:

<table>

<tr><td style="vertical-align:middle;width:50%"><span class='green'>Case 1</span>: $\color{magenta}X[i]=Y[j]$</td>
<td style="width:50%">

::: {.fragment fragment-index=1}
X = A<span class='red'>TCT</span>GCG<span class='magenta'>T</span><br>
Y = <span class='red'>T</span>G<span class='red'>C</span>A<span class='red'>T</span>A<span class='magenta'>T</span>
:::

</td></tr>

<tr><td></td><td>

::: {.fragment fragment-index=2}
$LCS(i,j)=LCS(i-1,j-1)+1$
:::

</td></tr><tr><td style="vertical-align:middle"><span class='blue'>Case 2</span>: $\color{magenta}X[i]\ne Y[j]$</td>
<td></td></tr>

<tr><td style="text-align:center">

::: {.fragment fragment-index=3}
X = A<span class='red'>TCT</span>GCG<span class='magenta'>A</span><br>
Y = <span class='red'>T</span>G<span class='red'>C</span>A<span class='red'>T</span><span class='magenta'>A</span>T
:::

</td><td style="text-align:center">

::: {.fragment fragment-index=5}
X = A<span class='red'>TCT</span>G<span class='magenta'>C</span>GT<br>
Y = <span class='red'>T</span>G<span class='red'>C</span>A<span class='red'>T</span>A<span class='magenta'>C</span>
:::

</td></tr>

<tr style="border-bottom:1px solid black"><td>

::: {.fragment fragment-index=4}
$LCS(i,j)=LCS(i,j-1)$
:::

</td><td>

::: {.fragment fragment-index=6}
$LCS(i,j)=LCS(i-1,j)$
:::

</td></tr>

</table>

::: {.fragment fragment-index=7}
$$LCS(i,j) = 
\begin{cases}
0 & \text{if } i=0 \text{ or } j=0 \\
{\color{green}LCS(i-1,j-1)+1} & \text{if } X[i]=Y[j] \\
{\color{blue}\max(LCS(i,j-1),LCS(i-1,j))} & \text{otherwise} \\
\end{cases}$$
:::

</div>


## Dynamic Programming

- Requires <span class="magenta">Optimal Substructure</span>
	- Solution to larger problem contains the (optimal) solutions to smaller ones
- Idea:
<ol>
	<li>Identify recursive structure of the problem
    	<ul><li>What is the "last thing" done?</li></ul></li>
	<li class="purple">Save the solution to each subproblem in memory</li>
	<li>Select a good order for solving subproblems
		<ul>
			<li>"Top Down": Solve each recursively</li>
			<li>"Bottom Up": Iteratively solve smallest to largest</li>
		</ul></li>
</ol>



## [Top-Down Solution with Memoization]{.r-fit-text}

We need two functions; one will be recursive

<div style="font-size:60% !important">

<table><tr><td style="vertical-align:top">

<table><tr><td style="border:2px solid blue">
::: {.no-bullets}
- <b>LCS-Length(X, Y):</b> <span class='green'>// Y is Ms cols.</span>
  - n = length(X)
  - m  = length(Y)
  - Create table M[n,m]
  - Assign -1 to all cells M[i,j]
  - <span class='green'>// get value for entire sequences</span>
  - return <b>LCS-recur</b>(X, Y, M, n, m)
:::
</td></tr></table>

&nbsp;

<table><tr style="border:2px dashed black"><td style="font-size:70%">
0<br>
$\color{green}LCS(i-1,j-1)+1$<br>
$\color{blue}\max(LCS(i,j-1),LCS(i-1,j))$
</td><td style="font-size:70%">
if $i=0$ or $j=0$<br>
if $X[i]=Y[j]$<br>
otherwise
</td></tr></table>

</td><td>

<table><tr><td style="border:2px solid blue !important">
::: {.no-bullets}
- <b>LCS-recur(X, Y, M, i, j):</b>
  - if (i == 0 || j == 0) return 0
  - <span class='green'>// have we already calculated </span>
  - <span class='green'>// this subproblem? </span>
  - if ( M[i,j] != -1 ) return M[i,j]
  - if ( X[i] == Y[j] )		
    - M[i,j] = <b>LCS-recur</b>(X, Y, M, <span style="background-color:yellow">i-1</span>, <span style="background-color:yellow">j-1</span>) + 1
  - else <span class='green'>// X[i] != Y[j]</span>
    - M[i,j] = max( <b>LCS-recur</b>(X, Y, M, <span style="background-color:yellow">i-1</span>, <span style="background-color:yellow">j</span>),
      - <b>LCS-recur</b>(X, Y, M, <span style="background-color:yellow">i</span>, <span style="background-color:yellow">j-1</span>) )
  - return M[i,j]
:::
</td></tr></table>

</td></tr></table>

</div>


## Dynamic Programming

- Requires <span class="magenta">Optimal Substructure</span>
	- Solution to larger problem contains the (optimal) solutions to smaller ones
- Idea:
<ol>
	<li>Identify recursive structure of the problem
    	<ul><li>What is the "last thing" done?</li></ul></li>
	<li>Save the solution to each subproblem in memory</li>
	<li class="purple">Select a good order for solving subproblems
		<ul>
			<li>"Top Down": Solve each recursively</li>
			<li>"Bottom Up": Iteratively solve smallest to largest</li>
		</ul></li>
</ol>


## Solve in a Good Order
<div style="font-size:90%">
$$\scriptstyle LCS(i,j) =
\begin{cases}
0 & \text{if } i=0 \text{ or } j=0 \\
{\color{green}LCS(i-1,j-1)+1} & \text{if } X[i]=Y[j] \\
{\color{blue}\max(LCS(i,j-1),LCS(i-1,j))} & \text{otherwise} \\
\end{cases}$$

::: {.r-stack}
![](images/dp/lcs-table.svg){.center style="width:100%"}

![](images/spacer.png)
:::

::: {.fragment}
To fill in cell $(i,j)$ we need cells $(i-1,j-1)$, $(i-1,j)$, and $(i,j-1)$
Fill from top &rarr; bottom, left &rarr; right (with any preference)
:::
</div>




## LCS Length Algorithm: Bottom-Up

::: {.no-bullets style="font-size:90%"}
- LCS-Length(X, Y) <span class='green'>// Y for Ms rows, X for its columns</span>
  - n = length(X)  <span class='green'>// get the length of X</span>
  - m  = length(Y) <span class='green'>// get the length of Y</span>
  - for i = 1 to n: M[i,0] = 0 <span class='green'>// special case: X0</span>
  - for j = 1 to m: M[0,j] = 0 <span class='green'>// special case: Y0</span>
  - for i = 1 to n: <span class='green'>// for all Xi</span>
    - for j = 1 to m: <span class='green'>// for all Yj</span>
      - if ( X[i] == Y[j] )
        - M[i,j] = M[i-1,j-1] + 1
      - else
        - M[i,j] = max( M[i-1,j], M[i,j-1] )
  - return M[n,m]   <span class='green'>// return LCS length for Y and X</span>
:::



## Run Time?
<div style="font-size:90%">
$$\scriptstyle LCS(i,j) =
\begin{cases}
0 & \text{if } i=0 \text{ or } j=0 \\
{\color{green}LCS(i-1,j-1)+1} & \text{if } X[i]=Y[j] \\
{\color{blue}\max(LCS(i,j-1),LCS(i-1,j))} & \text{otherwise} \\
\end{cases}$$

::: {.r-stack}
![](images/dp/lcs-table.svg){.center style="width:100%"}

![](images/spacer.png)
:::

::: {.fragment}
<span class='red'>Run time: $\Theta(n \cdot m)$ (for $|X|=n$, $|Y|=m$)</span>
:::
</div>





<!-- all x/y boxes -->
<!-- img src="images/dp/lcs-box.svg" style="margin-bottom:283px;margin-right:250px"> --> <!-- y=1 -->
<!-- img src="images/dp/lcs-box.svg" style="margin-bottom:283px;margin-right:100px"> --> <!-- y=2 -->
<!-- img src="images/dp/lcs-box.svg" style="margin-bottom:283px;margin-left:45px"> --> <!-- y=3 -->
<!-- img src="images/dp/lcs-box.svg" style="margin-bottom:283px;margin-left:194px"> --> <!-- y=4 -->
<!-- img src="images/dp/lcs-box.svg" style="margin-bottom:283px;margin-left:343px"> --> <!-- y=5 -->
<!-- img src="images/dp/lcs-box.svg" style="margin-bottom:283px;margin-left:494px"> --> <!-- y=6 -->
<!-- img src="images/dp/lcs-box.svg" style="margin-bottom:283px;margin-left:640px"> --> <!-- y=7 -->
<!-- img src="images/dp/lcs-box.svg" style="scale:90%;margin-bottom:81px;margin-right:600px"> --> <!-- x=1 -->
<!-- img src="images/dp/lcs-box.svg" style="scale:90%;margin-bottom:8px;margin-right:600px"> --> <!-- x=2 -->
<!-- img src="images/dp/lcs-box.svg" style="scale:90%;margin-bottom:-42px;margin-right:600px"> --> <!-- x=3 -->
<!-- img src="images/dp/lcs-box.svg" style="scale:90%;margin-bottom:-78px;margin-right:600px"> --> <!-- x=4 -->
<!-- img src="images/dp/lcs-box.svg" style="scale:90%;margin-bottom:-114px;margin-right:600px"> --> <!-- x=5 -->
<!-- img src="images/dp/lcs-box.svg" style="scale:90%;margin-bottom:-150px;margin-right:600px"> --> <!-- x=6 -->


<!-- all arrows (n, then w, then nw): the are all listed top-to-bottom, right-to-left.  spaces have to be between them for them to stack properly -->
<!--
<img src="images/dp/lcs-arrow-n.svg" style="margin-bottom:135px;margin-left:600px">
<img src="images/dp/lcs-arrow-n.svg" style="margin-bottom:62px;margin-left:450px">
<img src="images/dp/lcs-arrow-n.svg" style="margin-bottom:-12px;margin-left:300px">
<img src="images/dp/lcs-arrow-n.svg" style="margin-bottom:-53px;margin-left:150px">
<img src="images/dp/lcs-arrow-n.svg" style="margin-bottom:-89px;margin-left:0px">
<img src="images/dp/lcs-arrow-n.svg" style="margin-bottom:-127px;margin-right:155px">
<img src="images/dp/lcs-arrow-n.svg" style="margin-bottom:-127px;margin-right:305px">
<img src="images/dp/lcs-arrow-w.svg" style="margin-bottom:155px;margin-left:565px">
<img src="images/dp/lcs-arrow-w.svg" style="margin-bottom:80px;margin-left:410px">
<img src="images/dp/lcs-arrow-w.svg" style="margin-bottom:5px;margin-left:260px">
<img src="images/dp/lcs-arrow-w.svg" style="margin-bottom:-30px;margin-left:110px">
<img src="images/dp/lcs-arrow-w.svg" style="margin-bottom:-68px;margin-right:45px">
<img src="images/dp/lcs-arrow-w.svg" style="margin-bottom:-104px;margin-right:200px">
<img src="images/dp/lcs-arrow-w.svg" style="margin-bottom:-142px;margin-right:350px">
<img src="images/dp/lcs-arrow-nw.svg" style="margin-bottom:125px;margin-left:565px">
<img src="images/dp/lcs-arrow-nw.svg" style="margin-bottom:125px;margin-left:415px">
<img src="images/dp/lcs-arrow-nw.svg" style="margin-bottom:55px;margin-left:265px">
<img src="images/dp/lcs-arrow-nw.svg" style="margin-bottom:-10px;margin-left:115px">
<img src="images/dp/lcs-arrow-nw.svg" style="margin-bottom:-56px;margin-right:43px">
<img src="images/dp/lcs-arrow-nw.svg" style="margin-bottom:-93px;margin-right:195px">
<img src="images/dp/lcs-arrow-nw.svg" style="margin-bottom:-130px;margin-right:345px">
-->





## Reconstructing the LCS example 1
<div style="font-size:90%">
$$\scriptstyle LCS(i,j) =
\begin{cases}
0 & \text{if } i=0 \text{ or } j=0 \\
{\color{green}LCS(i-1,j-1)+1} & \text{if } X[i]=Y[j] \\
{\color{blue}\max(LCS(i,j-1),LCS(i-1,j))} & \text{otherwise} \\
\end{cases}$$

::: {.r-stack}
![](images/dp/lcs-table.svg){.center style="width:100%"}

<img src="images/dp/lcs-box.svg" style="margin-bottom:283px;margin-left:194px"> <!-- y=4 -->

<img src="images/dp/lcs-box.svg" style="margin-bottom:283px;margin-left:343px"> <!-- y=5 -->

<img src="images/dp/lcs-box.svg" style="margin-bottom:283px;margin-left:494px"> <!-- y=6 -->

<img src="images/dp/lcs-box.svg" style="margin-bottom:283px;margin-left:640px"> <!-- y=7 -->

[<img src="images/dp/lcs-arrow-n.svg" style="margin-bottom:-127px;margin-left:600px">]{.fragment fragment-index=2}

[<img src="images/dp/lcs-box.svg" style="scale:90%;margin-bottom:-114px;margin-right:600px">]{.fragment fragment-index=3} <!-- x=5 -->

[<img src="images/dp/lcs-arrow-nw.svg" style="margin-bottom:-93px;margin-left:565px">]{.fragment fragment-index=4}

[<img src="images/dp/lcs-box.svg" style="scale:90%;margin-bottom:-78px;margin-right:600px">]{.fragment fragment-index=5} <!-- x=4 -->

[<img src="images/dp/lcs-arrow-nw.svg" style="margin-bottom:-56px;margin-left:415px">]{.fragment fragment-index=6}

[<img src="images/dp/lcs-arrow-n.svg" style="margin-bottom:-12px;margin-left:300px">]{.fragment fragment-index=7}

[<img src="images/dp/lcs-box.svg" style="scale:90%;margin-bottom:8px;margin-right:600px">]{.fragment fragment-index=8} <!-- x=2 -->

[<img src="images/dp/lcs-arrow-nw.svg" style="margin-bottom:55px;margin-left:265px">]{.fragment fragment-index=9}

[<img src="images/dp/lcs-box.svg" style="scale:90%;margin-bottom:81px;margin-right:600px">]{.fragment fragment-index=10} <!-- x=1 -->

[<img src="images/dp/lcs-arrow-nw.svg" style="margin-bottom:125px;margin-left:115px">]{.fragment fragment-index=11}

:::

::: {.fragment fragment-index=1}
Start from bottom right,<br>
<span class='green'>if symbols matched, print that symbol then go diagonally</span>, <br>
<span class='blue'>else go to largest adjacent</span>
:::

</div>






## Reconstructing the LCS example 2
<div style="font-size:90%">
$$\scriptstyle LCS(i,j) =
\begin{cases}
0 & \text{if } i=0 \text{ or } j=0 \\
{\color{green}LCS(i-1,j-1)+1} & \text{if } X[i]=Y[j] \\
{\color{blue}\max(LCS(i,j-1),LCS(i-1,j))} & \text{otherwise} \\
\end{cases}$$

::: {.r-stack}
![](images/dp/lcs-table.svg){.center style="width:100%"}

<img src="images/dp/lcs-box.svg" style="margin-bottom:283px;margin-right:100px"> <!-- y=2 -->

<img src="images/dp/lcs-box.svg" style="margin-bottom:283px;margin-left:45px"> <!-- y=3 -->

<img src="images/dp/lcs-box.svg" style="margin-bottom:283px;margin-left:494px"> <!-- y=6 -->

<img src="images/dp/lcs-box.svg" style="margin-bottom:283px;margin-left:640px"> <!-- y=7 -->

[<img src="images/dp/lcs-box.svg" style="scale:90%;margin-bottom:81px;margin-right:600px">]{.fragment fragment-index=11} <!-- x=1 -->

[<img src="images/dp/lcs-box.svg" style="scale:90%;margin-bottom:-42px;margin-right:600px">]{.fragment fragment-index=8} <!-- x=3 -->

[<img src="images/dp/lcs-box.svg" style="scale:90%;margin-bottom:-78px;margin-right:600px">]{.fragment fragment-index=4} <!-- x=4 -->

[<img src="images/dp/lcs-box.svg" style="scale:90%;margin-bottom:-114px;margin-right:600px">]{.fragment fragment-index=2} <!-- x=5 -->

[<img src="images/dp/lcs-arrow-n.svg" style="margin-bottom:-127px;margin-left:600px">]{.fragment fragment-index=1}

[<img src="images/dp/lcs-arrow-nw.svg" style="margin-bottom:-93px;margin-left:565px">]{.fragment fragment-index=3}

[<img src="images/dp/lcs-arrow-nw.svg" style="margin-bottom:-56px;margin-left:415px">]{.fragment fragment-index=5}

[<img src="images/dp/lcs-arrow-w.svg" style="margin-bottom:-30px;margin-left:265px">]{.fragment fragment-index=6}

[<img src="images/dp/lcs-arrow-w.svg" style="margin-bottom:-30px;margin-left:110px">]{.fragment fragment-index=7}

[<img src="images/dp/lcs-arrow-nw.svg" style="margin-bottom:-10px;margin-right:43px">]{.fragment fragment-index=9}

[<img src="images/dp/lcs-arrow-n.svg" style="margin-bottom:62px;margin-right:155px">]{.fragment fragment-index=10}

[<img src="images/dp/lcs-arrow-nw.svg" style="margin-bottom:125px;margin-right:195px">]{.fragment fragment-index=12}

:::

Start from bottom right,<br>
<span class='green'>if symbols matched, print that symbol then go diagonally</span>, <br>
<span class='blue'>else go to largest adjacent</span>
</div>






## Reconstructing the LCS example 3
<div style="font-size:90%">
$$\scriptstyle LCS(i,j) =
\begin{cases}
0 & \text{if } i=0 \text{ or } j=0 \\
{\color{green}LCS(i-1,j-1)+1} & \text{if } X[i]=Y[j] \\
{\color{blue}\max(LCS(i,j-1),LCS(i-1,j))} & \text{otherwise} \\
\end{cases}$$

::: {.r-stack}
![](images/dp/lcs-table.svg){.center style="width:100%"}

<img src="images/dp/lcs-box.svg" style="scale:90%;margin-bottom:-150px;margin-right:600px"> <!-- x=6 -->

<img src="images/dp/lcs-box.svg" style="scale:90%;margin-bottom:-114px;margin-right:600px"> <!-- x=5 -->

<img src="images/dp/lcs-box.svg" style="scale:90%;margin-bottom:-42px;margin-right:600px"> <!-- x=3 -->

<img src="images/dp/lcs-box.svg" style="scale:90%;margin-bottom:81px;margin-right:600px"> <!-- x=1 -->

[<img src="images/dp/lcs-arrow-w.svg" style="margin-bottom:-142px;margin-left:565px">]{.fragment fragment-index=1}

[<img src="images/dp/lcs-box.svg" style="margin-bottom:283px;margin-left:494px">]{.fragment fragment-index=2} <!-- y=6 -->

[<img src="images/dp/lcs-arrow-nw.svg" style="margin-bottom:-130px;margin-left:415px">]{.fragment fragment-index=3}

[<img src="images/dp/lcs-arrow-w.svg" style="margin-bottom:-104px;margin-left:260px">]{.fragment fragment-index=4}

[<img src="images/dp/lcs-box.svg" style="margin-bottom:283px;margin-left:194px">]{.fragment fragment-index=5} <!-- y=4 -->

[<img src="images/dp/lcs-arrow-nw.svg" style="margin-bottom:-93px;margin-left:115px">]{.fragment fragment-index=6}

[<img src="images/dp/lcs-arrow-n.svg" style="margin-bottom:-53px;margin-left:0px">]{.fragment fragment-index=7}

[<img src="images/dp/lcs-box.svg" style="margin-bottom:283px;margin-left:45px">]{.fragment fragment-index=8} <!-- y=3 -->

[<img src="images/dp/lcs-arrow-nw.svg" style="margin-bottom:-10px;margin-right:43px">]{.fragment fragment-index=9}

[<img src="images/dp/lcs-arrow-n.svg" style="margin-bottom:62px;margin-right:155px">]{.fragment fragment-index=10}

[<img src="images/dp/lcs-box.svg" style="margin-bottom:283px;margin-right:100px">]{.fragment fragment-index=11} <!-- y=2 -->

[<img src="images/dp/lcs-arrow-nw.svg" style="margin-bottom:125px;margin-right:195px">]{.fragment fragment-index=12}

:::

Start from bottom right,<br>
<span class='green'>if symbols matched, print that symbol then go diagonally</span>, <br>
<span class='blue'>else go to largest adjacent</span>
</div>









# Gerrymandering <!-- from day19.pptx -->

::: {.titlereading}
Readings in CLRS 4th edition: chapter 14
:::


----

![](images/dp/gerrymander-1.webp){.stretch .center}



----

::: {.r-stack}
![](images/dp/gerrymander-2.webp){style="z-index:1;margin-left:-400px;margin-top:-100px;width:600px;min-width:600px;max-width:600px;border:1px solid black"}

::: {.fragment}
![](images/dp/gerrymander-3.webp){style="z-index:2;margin-left:-150px;margin-top:0px;width:600px;min-width:600px;max-width:600px;border:1px solid black"}
:::

::: {.fragment}
![](images/dp/gerrymander-4.webp){style="z-index:3;margin-left:100px;margin-top:100px;width:600px;min-width:600px;max-width:600px;border:1px solid black"}
:::

::: {.fragment}
![](images/dp/gerrymander-5.webp){style="z-index:4;margin-left:350px;margin-top:0px;width:600px;min-width:600px;max-width:600px;border:1px solid black"}
:::
:::



## Gerrymandering

![](https://upload.wikimedia.org/wikipedia/commons/thumb/9/96/The_Gerry-Mander_Edit.png/978px-The_Gerry-Mander_Edit.png){style="float:right;width:40%;height:40%"}

- Manipulating electoral district boundaries to favor one political party over others
- Coined in an 1812 Political cartoon
- Governor **Elbridge Gerry** signed a bill that redistricted Massachusetts to benefit his Democratic-Republican Party


## According to the Supreme Court

- Gerrymandering cannot be used to:
  - Disadvantage racial/ethnic/religious groups
- It can be used to:
  - Disadvantage political parties

![](images/dp/gerrymander-2.webp){style="float:left;border:1px solid black;width:"}
![](images/dp/gerrymander-3.webp){style="float:right;border:1px solid black"}


## Virginia's 5th District (until 2023)

::: {.r-stack}

![](https://upload.wikimedia.org/wikipedia/commons/thumb/1/15/Virginia_US_Congressional_District_5_%28since_2013%29.tif/lossless-page1-1024px-Virginia_US_Congressional_District_5_%28since_2013%29.tif.png){.center}

::: {.fragment}
![](https://cdn.theatlantic.com/thumbor/moUnkgB6FkXSafXAm06y8_4IRnQ=/0x0:1643x924/976x549/media/img/mt/2019/05/MBDGODZ_EC005_1/original.jpg){style="width:400px;height:500px;object-fit:cover;transform:scale(0.75);border-radius:20px;margin-left:175px"}
:::

:::

## Virginia's 5th District in 2018

<table><tr><td style="vertical-align:top">

<table>
<tr><td></td><td>Votes</td><td>Percent</td></tr>
<tr><td class='red' style="min-width:100px"></td><td>165,339</td><td>53.3%</td></tr>
<tr><td class='blue' style="min-width:100px"></td><td>145,040</td><td>46.7%</td></tr>
</table>

</td><td>

![](https://upload.wikimedia.org/wikipedia/commons/4/4c/2018_general_election_in_Virginia%27s_5th_congressional_district_by_county.svg){.center}

</td></tr></table>



## End of VA gerrymandering

- A 2020 [state constitutional amendment](https://www.elections.virginia.gov/proposed-constitutional-amendment-2020/) changed how the state sets districts
  - [Wikipedia article](https://en.wikipedia.org/wiki/2020_Virginia_Question_1)
- The redistricting committee:
	- Four state senators, two from each party
	- Four state house delegate members, two from each party
	- Eight citizens
- It's voted on, but not changeable by, the general assembly
	- The governor is not involved at all
- It passed with 65.69% of the vote


## Virginia's 5th District (today)

&nbsp;

![](https://upload.wikimedia.org/wikipedia/commons/thumb/e/e5/Virginia%27s_5th_congressional_district_%28from_2023%29.png/1024px-Virginia%27s_5th_congressional_district_%28from_2023%29.png){.center}


## [Virginia's congressional districts (today)]{.r-fit-text}

![](https://upload.wikimedia.org/wikipedia/commons/9/90/Virginia_Congressional_Districts%2C_118th_Congress_%282%29.svg)


## Gerrymandering Today

![](images/dp/md-3rd-district.webp){.center}

## Pennsylvania 2018 controversy

<p style="font-size:70%">Math and CS professors have been asked to testify in court as to the difficulty in creating some of these districts</p>

<table><tr><td style="width:60%;vertical-align:top">

::: {.r-stack}
![](https://upload.wikimedia.org/wikipedia/commons/thumb/5/53/Pennsylvania_Congressional_Districts_113th_Congress.png/1024px-Pennsylvania_Congressional_Districts_113th_Congress.png){style="float:left;width:100%"}

<p style="font-size:40%;margin-top:0;margin-right:0">[https://www.usnews.com/news/national-news/articles/2018-02-20/what-<br>pennsylvanias-new-court-drawn-congressional-redistricting-looks-like](https://www.usnews.com/news/national-news/articles/2018-02-20/what-pennsylvanias-new-court-drawn-congressional-redistricting-looks-like)</p>
:::

</td><td style="width:40%;padding:0">

![](https://upload.wikimedia.org/wikipedia/commons/thumb/4/49/Pennsylvania_US_Congressional_District_7_%28since_2013%29.tif/lossless-page1-1024px-Pennsylvania_US_Congressional_District_7_%28since_2013%29.tif.png){style="float:right;width:400px;height:300px;object-fit:cover;object-position:-25% 0"}

<p style="font-size:30%;text-align:center">[https://www.heinz.cmu.edu/media/2018/<br>October/wes-pegden-gerrymandering](https://www.heinz.cmu.edu/media/2018/October/wes-pegden-gerrymandering)</p>

</td></tr></table>

<table class='border' style="font-size:50%"><tr><td style="text-align:justify">"Wesley Pegden, professor of mathematical sciences at Carnegie Mellon University, proved that Pennsylvanias congressional map was a partisan gerrymanderin fact, he showed that if you made trillions of districtings by making small random perturbations to the map, 99.9999999% of them of them would be fairer than the existing map, a property which is mathematically impossible to be typical for a Congressional districting, regardless of the political geography of a state. His expert testimony during a lawsuit led to the Pennsylvania supreme court throwing out the old map." [https://www.heinz.cmu.edu/media/2018/October/wes-pegden-gerrymandering](https://www.heinz.cmu.edu/media/2018/October/wes-pegden-gerrymandering)</td></tr></table>

## How does it work?

![](https://upload.wikimedia.org/wikipedia/commons/d/d3/DifferingApportionment.svg){style="float:right;width:33%;height:auto;margin-top:0;margin-left:30px"}

<div style="font-size:95%">

- States are broken into precincts
- All precincts have the same size
- We know voting preferences of each precinct
- Group precincts into districts to maximize the number of districts won by my party
- Consider the district to the right; 5 different ways to split up the voters
	- Upper left: 0 yellow, 5 blue
	- Upper right: 3 yellow, 2 blue
	- Both lower: 2 yellow, 3 blue

</div>


## How does it work?

::: {.font-90}
- States are broken into precincts
- All precincts have the same size
- We know voting preferences of each precinct
- Group precincts into districts to maximize the number of districts won by my party
:::

<table style="width:100%;margin-top:35px" class="compact font-70">
<tr><td>
<table class="border3px allcenter minsize4em">
<tr><td colspan=2 style="border:0;border-bottom:0 !important;height:0">Overall:</td></tr>
<tr><td colspan=2 style="border:0;height:0"><span class='magentatext'>A: 217</span>, <span class='greentext'>B: 183</span></td></tr>
<tr><td class='magenta'>A: 65<br>B: 35</td><td class='green'>A: 45<br>B: 55</td></tr>
<tr><td class='magenta'>A: 60<br>B: 40</td><td class='green'>A: 47<br>B: 53</td></tr>
</table>
</td><td>
::: {.fragment}
<table class="border3px allcenter minsize4em">
<tr><td style="border:0;border-bottom:0 !important;height:0">$D_1$</td><td style="border:0;border-bottom:0 !important;height:0">$D_2$</td></tr>
<tr><td class='magentatext' style="border:0;height:0">A: 125</td><td class='greentext' style="border:0;height:0">A: 92</td></tr>
<tr><td class='magenta'>A: 65<br>B: 35</td><td class='green' style="border-left:6px double black">A: 45<br>B: 55</td></tr>
<tr><td class='magenta'>A: 60<br>B: 40</td><td class='green' style="border-left:6px double black">A: 47<br>B: 53</td></tr>
</table>
:::
</td><td>
::: {.fragment}
<table class="border3px allcenter minsize4em">
<tr><td style="border:0;border-bottom:0 !important;height:0">$D_1$</td><td style="border:0;border-bottom:0 !important;height:0">$D_2$</td></tr>
<tr><td class='magentatext' style="border:0;height:0">A: 112</td><td class='magentatext' style="border:0;height:0">A: 105</td></tr>
<tr><td class='magenta'>A: 65<br>B: 35</td><td class='green' style="border-left:6px double black">A: 45<br>B: 55</td></tr>
<tr><td class='green'>A: 47<br>B: 53</td><td class='magenta' style="border-left:6px double black">A: 60<br>B: 40</td></tr>
</table>
:::
</td></tr></table>


## Gerrymandering problem statement

<table style="font-size:80%"><tr><td>

- Given:
  - A list of $n$ precincts: $p_1,p_2,\ldots,p_n$
  - Each containing $m$ voters
  - Total of $m \cdot n$ voters
- Output:
	- Districts ${\color{magenta}D_1}, {\color{green}D_2} \subset \{ p_1,p_2,\ldots,p_{n} \}$
	- Where $|{\color{magenta}D_1}| = |{\color{green}D_2}| = \frac{m \cdot n}{2}$
	- $S({\color{magenta}D_1})>\frac{m \cdot n}{4}$ and $S({\color{green}D_2})>\frac{m \cdot n}{4}$
		- $S(D_i)$ is the number (size) of voters of your party in district $D_i$
		- $S(D_i)>\frac{m \cdot n}{4}$ means district $D_i$ is majority your party
			- As there are $\frac{m \cdot n}{2}$ voters per district
	- "Failure" if no possible solution

</td><td style="vertical-align:bottom">


::: {.fragment fragment-index=3}
<table class='bluenote'><tr><td>Valid Gerrymandering!</td></tr></table>
:::

&nbsp;

::: {.fragment fragment-index=1}
<table class='purplenote'><tr><td>$\frac{m \cdot n}{4}=m \cdot \frac{n}{2} \cdot \frac{1}{2}$</td></tr></table>
:::

&nbsp;

::: {.fragment fragment-index=2}
<table class="border3px allcenter font-70">
<tr><td style="border:0">$\color{magenta}D_1$</td><td style="border:0">$\color{forestgreen}D_2$</td></tr>
<tr><td>$\frac{m \cdot n}{4}$</td><td style="border-left:6px double black">$\frac{m \cdot n}{4}$</td></tr>
<tr><td>$\frac{m \cdot n}{4}$</td><td style="border-left:6px double black">$\frac{m \cdot n}{4}$</td></tr>
</table>
:::

&nbsp;

</td></tr></table>



## Dynamic Programming

- Requires <span class="magenta">Optimal Substructure</span>
	- Solution to larger problem contains the (optimal) solutions to smaller ones
- Idea:
<ol>
	<li class="purple">Identify recursive structure of the problem
    	<ul><li>What is the "last thing" done?</li></ul></li>
	<li>Save the solution to each subproblem in memory</li>
	<li>Select a good order for solving subproblems
		<ul>
			<li>"Top Down": Solve each recursively</li>
			<li>"Bottom Up": Iteratively solve smallest to largest</li>
		</ul></li>
</ol>




## Consider the last precinct

<div style="font-size:70%">

<table class='allcenter' style="width=100%"><tr><td style="padding-left:0;padding-right:0">

<table style="border:0px solid red">
<tr><td>
After&nbsp;assigning&nbsp;first<br>$n-1$ precincts<br>$p_1,p_2,\ldots,p_{n-1}$
</td></tr><tr><td>
<table class="magentabox"><tr><td> $D_1$<br>$k$ precincts<br>$x$ voters for $R$<br>&nbsp;</td></tr></table>
</td></tr><tr><td>
<table class="greenbox"><tr><td> $D_2$<br>$n-k-1$<br>precincts<br>$y$ voters for $R$</td></tr></table>
</td></tr></table>

</td><td style="padding-left:0;padding-right:0">

<table style='compact'><tr><td style="padding-left:0;padding-right:0">
::: {.fragment fragment-index=1}
If&nbsp;we<br>assign<br>$p_n \text{ to } D_1$
:::
</td></tr><tr><td style="padding-left:0;padding-right:0">
<table class='navybox' style="border-radius:15px;width:unset;margin:auto"><tr><td>$p_n$</td></tr></table>
</td></tr><tr><td style="padding-left:0;padding-right:0">
::: {.fragment fragment-index=2}
If&nbsp;we<br>assign<br>$p_n \text{ to } D_2$
:::
</td></tr></table>

</td><td style="padding:0">

<table><tr><td>
::: {.fragment fragment-index=1}
![](images/dp/up-arrow-magenta.svg)
:::
</td></tr><tr><td>
</td></tr><tr><td>
::: {.fragment fragment-index=2}
![](images/dp/down-arrow-green.svg)
:::
</td></tr></table>

</td><td style="padding-left:0">

<table class='allcenter'>
<tr><td style="padding:0">
&nbsp;
</td></tr><tr><td style="padding:0">
::: {.fragment fragment-index=1}
<table class="magentabox"><tr><td> $D_1$<br>$k+1$ precincts<br>$x+S(p_n)$ voters for $R$</td></tr></table>
:::
</td></tr><tr><td style="padding:0" class="left-align">
::: {.fragment fragment-index=5}
Valid&nbsp;gerrymandering<br>if: $k+1=\frac{n}{2}$ (or $\frac{n}{2}+1$), $x+S(p_n), y > \frac{mn}{4}$
:::
</td></tr><tr><td style="padding:0">
&nbsp;
</td></tr><tr><td style="padding:0">
::: {.fragment fragment-index=2}
<table class="greenbox"><tr><td> $D_2$<br>$n-k$ precincts<br>$y+S(p_n)$ voters for $R$</td></tr></table>
:::
</td></tr><tr><td style="padding:0" class="left-align">
::: {.fragment fragment-index=5}
Valid&nbsp;gerrymandering<br>if: $n-k=\frac{n}{2}$ (or $\frac{n}{2}+1$), $x,y+S(p_n) > \frac{mn}{4}$
:::
</td></tr><tr><td>
</td></tr></table>

</td><td style="padding-right:0">

::: {.fragment fragment-index=3}
<table style="border:0px solid blue;font-size:60%;background-color:lavender">
<tr><td>
<table class="magentabox" style="margin-top:10px"><tr><td> $D_1$<br>$k+1$ precincts<br>$x+S(p_n)$ voters for $R$</td></tr></table>
</td></tr><tr><td>
<table class="greenbox"><tr><td> $D_2$<br>$n-k-1$ precincts<br>$y$ voters for $R$</td></tr></table>
</td></tr><tr><td class="left-align">
Valid&nbsp;gerrymandering if: $k+1=\frac{n}{2}$ (or $\frac{n}{2}+1$),<br>$x+S(p_n), y > \frac{mn}{4}$</td></tr><tr><td>
</td></tr><tr><td style="text-align:center;font-size:1.5em">
World One
</td></tr></table>
:::

::: {.fragment fragment-index=4}
<table style="border:0px solid blue;font-size:60%;background-color:lavender;margin-top:20px">
<tr><td>
<table class="magentabox" style="margin-top:10px"><tr><td> $D_1$<br>$k$ precincts<br>$x$ voters for $R$</td></tr></table>
</td></tr><tr><td>
<table class="greenbox"><tr><td> $D_2$<br>$n-k$ precincts<br>$y+S(p_n)$ voters for $R$</td></tr></table>
</td></tr><tr><td class="left-align">
Valid&nbsp;gerrymandering if: $n-k=\frac{n}{2}$ (or $\frac{n}{2}+1$),<br>$x,y+S(p_n) > \frac{mn}{4}$</td></tr><tr><td>
</td></tr><tr><td style="text-align:center;font-size:1.5em">
World Two
</td></tr></table>
:::

</td></tr></table>

</div>



## Define Recursive Structure

<table><tr><td>
$S(j,k,x,y) = \text{True}$
</td><td>
if from among the first $j$ precincts:<br>
$k$ are assigned to $\color{magenta}D_1$<br>
exactly $x$ vote for R in $\color{magenta}D_1$<br>
exactly $y$ vote for R in $\color{green}D_2$
</td></tr><tr><td>
::: {.fragment fragment-index=1}
$\color{red}n \times n \times mn \times mn$
:::
</td><td></td></tr>
<tr><td>&nbsp;</td><td>&nbsp;</td></tr>

<tr><td class='redtext left-align'>
::: {.fragment fragment-index=2}
4D Dynamic programming!
:::
</td><td>

::: {.fragment fragment-index=3}
<table class='bluenote'><tr><td style="font-size:80%">True here means that this is a valid state of the world, not a valid gerrymander!</td></tr></table>
:::

</td></tr>

</td></tr></table>


## Two ways to satisfy $S(j,k,x,y)$

<div style="font-size:70%">

<table class='allcenter' style="width=100%"><tr><td style="padding-left:0;padding-right:0">

::: {.fragment fragment-index=1}
<table style="border:0px solid blue;font-size:80%;background-color:lavender;width:100%">
<tr><td>
<table class="magentabox" style="margin-top:10px"><tr><td>$D_1$<br>$k-1$ precincts<br>$x-S(P_j)$ voters for $R$</td></tr></table>
</td></tr><tr><td>
<table class="greenbox"><tr><td> $D_2$<br>$j-k$ precincts<br>$y$ voters for $R$</td></tr></table>
</td></tr><tr><td>
</td></tr></table>
:::

::: {.fragment fragment-index=3}
<table style="border:0px solid blue;font-size:80%;background-color:lavender;width:100%;margin-top:50px">
<tr><td></td></tr>
<tr><td>
<table class="magentabox" style="margin-top:10px"><tr><td> $D_1$<br>$k$ precincts<br>$x$ voters for $R$</td></tr></table>
</td></tr><tr><td>
<table class="greenbox"><tr><td> $D_2$<br>$j-k-1$ precincts<br>$y-S(p_j)$ voters for $R$</td></tr></table>
</td></tr><tr><td>
</td></tr></table>
:::

</td><td style="width:10px">
</td><td>

<table style='compact'><tr><td style="padding-left:0;padding-right:0">
::: {.fragment fragment-index=1}
<table class='navybox' style="border-radius:15px;width:unset;margin:auto"><tr><td>$p_j$</td></tr></table>
:::
</td></tr><tr><td style="padding-left:0;padding-right:0">
::: {.fragment fragment-index=1}
Then&nbsp;assign<br>$p_j$ to $D_1$
:::
</td></tr><tr><td style="padding-left:0;padding-right:0">
::: {.fragment fragment-index=2}
<span style="font-size:3em">OR</span>
:::
</td></tr><tr><td style="padding-left:0;padding-right:0">
::: {.fragment fragment-index=3}
<table class='navybox' style="border-radius:15px;width:unset;margin:auto"><tr><td>$p_j$</td></tr></table>
:::
</td></tr><tr><td style="padding-left:0;padding-right:0">
::: {.fragment fragment-index=3}
Then&nbsp;assign<br>$p_j$ to $D_2$
:::
</td></tr><tr><td style="padding-left:0;padding-right:0">
</td></tr></table>

</td><td>

<table><tr><td style="height:40px">
</td></tr><tr><td>
::: {.fragment fragment-index=1}
<img src="images/dp/up-arrow-magenta.svg" style="transform:rotate(70deg)">
:::
</td></tr><tr><td style="height:60px">
</td></tr><tr><td>
::: {.fragment fragment-index=3}
<img src="images/dp/down-arrow-green.svg" style="transform:rotate(-20deg)">
:::
</td></tr></table>

</td><td>

<table><tr><td>
<table class='border'><tr><td style="font-size:70%">
$S(j,k,x,y)$ true if:<br>
&nbsp;&nbsp;&nbsp;&nbsp;from among the first $j$ precincts<br>
&nbsp;&nbsp;&nbsp;&nbsp;$k$ are assigned to $\color{magenta}D_1$<br>
&nbsp;&nbsp;&nbsp;&nbsp;exactly $x$ vote for $R$ in $\color{magenta}D_1$<br>
&nbsp;&nbsp;&nbsp;&nbsp;exactly $y$ vote for $R$ in $\color{green}D_2$
</td></tr></table>
</td></tr><tr><td>
<table class="magentabox" style="margin-top:10px"><tr><td>$D_1$<br>$k$ precincts<br>$x$ voters for $R$</td></tr></table>
</td></tr><tr><td>
<table class="greenbox" style="margin-top:10px"><tr><td>$D_2$<br>$j-k$ precincts<br>$y$ voters for $R$</td></tr></table>
</td></tr></table>

</td></tr></table>

$$S(j,k,x,y) = {\color{magenta}S(j-1,k-1,x-S(p_j),y)} \vee {\color{green}S(j-1,k,x,y-S(p_j))}$$

</div>


## Final Algorithm

$$\small S(j,k,x,y) = {\color{magenta}S(j-1,k-1,x-S(p_j),y)} \vee {\color{green}S(j-1,k,x,y-S(p_j))}$$

<table style="width:100%"><tr><td style="padding-bottom:0px">

:::{.no-bullets style="margin-left:-40px"}
- Initialize $S(0,0,0,0) = \text{True}$
- for $j=1,\ldots,n$:
	- for $k=1,\ldots,\min(j,\frac{n}{2})$:
		- for $x=1,\ldots,j \cdot m$:
			- for $y=1,\ldots,j \cdot m$:
:::


</td><td>

<table class='border'><tr><td style="font-size:70%">
$S(j,k,x,y)$ true if:<br>
&nbsp;&nbsp;&nbsp;&nbsp;from among the first $j$ precincts<br>
&nbsp;&nbsp;&nbsp;&nbsp;$k$ are assigned to $\color{magenta}D_1$<br>
&nbsp;&nbsp;&nbsp;&nbsp;exactly $x$ vote for $R$ in $\color{magenta}D_1$<br>
&nbsp;&nbsp;&nbsp;&nbsp;exactly $y$ vote for $R$ in $\color{green}D_2$
</td></tr></table>

</td></tr><tr><td colspan='2' style="padding-top:0">

<p style="margin-top:-40px;margin-left:20px">$$\begin{align} S(j,k,x,y) = & {\color{magenta}S(j-1,k-1,x-S(p_j),y)} \vee \\ & {\color{green}S(j-1,k,x,y-S(p_j))} \end{align}$$</p>

</td></tr><tr><td colspan='2' style="padding-top:0">

Search for True entry at $S \left( n, \frac{n}{2}, >\frac{m \cdot n}{4}, >\frac{m \cdot n}{4} \right)$

</td></tr></table>


## Gerrymander Run Time

$$\small S(j,k,x,y) = {\color{magenta}S(j-1,k-1,x-S(p_j),y)} \vee {\color{green}S(j-1,k,x,y-S(p_j))}$$

<table style="width:100%"><tr><td style="padding-bottom:0px">

:::{.no-bullets style="margin-left:-40px"}
- Initialize $S(0,0,0,0) = \text{True}$
- for $j=1,\ldots,n$:
	- for $k=1,\ldots,\min(j,\frac{n}{2})$:
		- for $x=1,\ldots,j \cdot m$:
			- for $y=1,\ldots,j \cdot m$:
:::


</td><td>


:::{.no-bullets style="margin-left:-40px"}
- &nbsp;
- [$\color{red}n$]{.fragment}
- [$\color{red}n/2$]{.fragment}
- [$\color{red}n \cdot m$]{.fragment}
- [$\color{red}n \cdot m$]{.fragment}
:::


</td></tr><tr><td colspan='2' style="padding-top:0">

<p style="margin-top:-40px;margin-left:20px">$$\begin{align} S(j,k,x,y) = & {\color{magenta}S(j-1,k-1,x-S(p_j),y)} \vee \\ & {\color{green}S(j-1,k,x,y-S(p_j))} \end{align}$$</p>

</td></tr><tr><td colspan='2' style="padding-top:0" class='redtext'>

::: {.fragment}
Total run time: $\Theta(n^4m^2)$
:::

</td></tr></table>


## $\color{pink}\Theta(n^4m^2)$

- Input: list of precincts (size $n$), number of voters (integer $m$)
- Runtime depends on the <span class='purpletext'>value of $m$</span>, not <span class='redtext'>size of $m$</span>
  - Run time is exponential in <span class='redtext'><i>size</i></span> of input
	- Input size is $n+|m|=n+\log m$
- Note: Gerrymandering is NP-Complete

## Gerrymandering Font

![](https://upload.wikimedia.org/wikipedia/commons/b/bf/Ugly_Gerry_font_sample.png){style="width:100%"}

[source](https://commons.wikimedia.org/wiki/File:Ugly_Gerry_font_sample.png)

